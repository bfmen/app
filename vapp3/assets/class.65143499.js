import{c as s}from"./config.c00927f2.js";import _ from"./list.fdcf3473.js";import v from"./tagSelect.16da57ae.js";import{a as u}from"./axios.646f38c1.js";import{_ as k,r as n,o as c,c as g,F as w,b as q,h as f,w as L,a as C}from"./index.6e7bc473.2022_10_28_19_14_01.js";import"./index.e34e0a2c.js";const S={components:{list:_,tagSelect:v},data(){return{loading:!1,finished:!1,page:0,identifier:0,vodrows:[],dataSource:{params:{},action:""},classList:[{key:"categories",query:"cateid",id:0},{key:"areas",query:"areaid",id:0},{key:"years",query:"yearid",id:0},{key:"definitions",query:"definition",id:0},{key:"durations",query:"duration",id:0},{key:"freetypes",query:"freetype",id:0},{key:"mosaics",query:"mosaic",id:0},{key:"langvoices",query:"langvoice",id:0},{key:"orders",query:"order",id:0}]}},computed:{tags(){let e=[];return this.classList.forEach(a=>{let o=this.dataSource[a.key];o&&e.push({items:[{id:0,title:"\u5168\u90E8"}].concat(o.map(t=>{let i=t.keyid||t.cateid||t.areaid||t.yearid;return{...t,id:i}})),id:a.id})}),e}},created(){this.loadBaseData()},methods:{tagClick(e,a){this.classList[e].id=this.tags[e].items[a].id,this.loadPageData(1),this.finished=!1},itemClick(e){e.spid&&uni.navigateTo({url:"./detail?spid="+e.spid})},infinite(){this.loading=!0,console.log("onReachBottom"),this.loadPageData(this.page+1)},loadBaseData(){u.request({url:s.origin+"/vod/recommend",params:s.query()}).then(e=>{console.log("success",e),e.status==200&&e.data.retcode==0?this.dataSource=e.data.data:window.$dialog.alert({title:e.data.errmsg||e.statusCode||"fail"})}).catch(e=>{window.$dialog.alert({title:e.message||"fail"})})},loadPageData(e){u({url:s.origin+"/vod/listing-"+this.classList.map(a=>a.id).join("-")+"-"+this.page,params:s.query()}).then(a=>{this.loading=!1,console.log("success",a),a.status==200&&a.data.retcode==0?(this.page=e,this.page==1?this.vodrows=a.data.data.vodrows:this.vodrows=this.vodrows.concat(a.data.data.vodrows),a.data.data.vodrows.length<16?this.finished=!0:this.loading=!1):(weui.topTips(a.data.errmsg||a.statusCode||"fail"),this.loading=!1)}).catch(a=>{this.loading=!1,weui.topTips(a.message||"fail")})}},watch:{classList:{deep:!0,handler(e){console.log("classList",e),this.page=0,this.vodrows=[],this.identifier=new Date().valueOf()}}}},B={class:"class"};function D(e,a,o,t,i,d){const h=n("tagSelect"),p=n("list"),m=n("van-list");return c(),g("div",B,[(c(!0),g(w,null,q(d.tags,(l,r)=>(c(),C(h,{ref_for:!0,ref:`tagSelect${r}`,dataSource:l,key:r,onTagClick:y=>d.tagClick(r,y)},null,8,["dataSource","onTagClick"]))),128)),f(m,{modelValue:i.loading,"onUpdate:modelValue":a[0]||(a[0]=l=>i.loading=l),finished:i.finished,"finished-text":"\u6CA1\u6709\u66F4\u591A\u4E86",onLoad:d.infinite,style:{"min-height":"50vh"}},{default:L(()=>[f(p,{dataList:i.vodrows},null,8,["dataList"])]),_:1},8,["modelValue","finished","onLoad"])])}const b=k(S,[["render",D],["__scopeId","data-v-d0c94438"]]);export{b as default};
