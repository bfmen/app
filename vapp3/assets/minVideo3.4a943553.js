import{c as d}from"./config.c00927f2.js";import{_ as w,r as m,o,c as a,f as p,F as v,b as _,h as y,w as f,l as g,g as h,t as x}from"./index.bdd1db7f.2022_10_27_04_28_54.js";const S={data(){return{sliderValue:0,minHeight:"100vh",mySwiper:null,rows:(()=>Array.from(Array(0)).map((e,t)=>({url:require(`@/assets/test/${t+1}.jpg`)})))()}},computed:{currentItem(){return this.rows.length?this.rows[this.mySwiper.activeIndex]:null}},watch:{"mySwiper.activeIndex":{handler:function(e){this.sliderValue=e,console.log("mySwiper",e),this.videoUrlUpdate(),e>=this.rows.length-2&&this.loadData(!1)}}},created(){this.minHeight=window.innerHeight+"px",this.loadData(!0)},mounted(){this.initSwiper()},methods:{loadImage(){},onChange(e){this.mySwiper.slideTo(e)},loadData(e){return this.$axios.request({url:d.origin+"/minivod/reqlist",params:d.query()}).then(t=>{if(console.log("success",t),t.status==200&&t.data.retcode==0){var l=[];t.data.data.rows.map(r=>{r.vodrow&&r.vodrow.vodid&&(r.videoUrl="",l.push(r))}),e?this.rows=l:this.rows.push(...l),this.$nextTick(()=>{this.mySwiper.updateSlides()})}else weui.topTips(t.data.errmsg||t.statusCode||"fail")}).catch(t=>{this.isMoreLoading=!1,weui.topTips(t.message||"fail")})},videoUrlUpdate(){this.$nextTick(()=>{this.$refs.video&&this.$refs.video.forEach(e=>{e.id==this.currentItem.vodrow.vodid?e.play():e.pause()})}),this.rows.filter((e,t)=>Math.abs(this.mySwiper.activeIndex-t)<=1).forEach(e=>{e.videoUrl||this.$axios.request({url:d.origin+e.vodrow.play_url,params:d.query()}).then(t=>{e.videoUrl=t.data.data.httpurl||t.data.data.httpurl_preview})})},initSwiper(){var e=new Swiper(".swiper",{loop:!1,pagination:{el:".swiper-pagination"},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},scrollbar:{el:".swiper-scrollbar"}});this.mySwiper=Array.isArray(e)?e[e.length-1]:e}}},V={class:"swiper"},b={class:"swiper-wrapper"},U={key:0,style:{height:"100%"}},C=["id","autoplay","src","poster"],I={style:{"margin-left":"20px",position:"absolute",bottom:"20px",width:"calc(100% - 40px)","z-index":"100"}},k={class:"custom-button",style:{}};function q(e,t,l,r,i,c){const u=m("van-slider");return o(),a("div",{class:"minVideo3",style:g(`min-height: ${i.minHeight};`)},[p("div",V,[p("div",b,[(o(!0),a(v,null,_(i.rows,(s,n)=>(o(),a("div",{class:"swiper-slide",key:n},[i.mySwiper&&Math.abs(i.mySwiper.activeIndex-n)<=1?(o(),a("div",U,[Math.abs(i.mySwiper.activeIndex-n)<=1?(o(),a("video",{key:0,class:"video",id:s.vodrow.vodid,controls:"controls",ref_for:!0,ref:"video",playsinline:"",autoplay:i.mySwiper.activeIndex==n,width:"100%",src:s.videoUrl,poster:s.vodrow&&s.vodrow.coverpic},null,8,C)):h("",!0)])):h("",!0)]))),128))])]),p("div",I,[y(u,{modelValue:i.sliderValue,"onUpdate:modelValue":t[0]||(t[0]=s=>i.sliderValue=s),onChange:c.onChange,max:i.rows.length-1,"inactive-color":"e0e0e0"},{button:f(()=>[p("div",k,x(i.sliderValue),1)]),_:1},8,["modelValue","onChange","max"])])],4)}const A=w(S,[["render",q],["__scopeId","data-v-0fd46763"]]);export{A as default};
