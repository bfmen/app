import{c as h}from"./config.c00927f2.js";import y from"./list.5b720606.js";import x from"./tagSelect.e5272a58.js";import{a as b}from"./axios.91e25212.js";import{z as T}from"./zip.8189dec6.js";import{D as L}from"./index.23b46475.js";import{_ as D,r as d,o as C,c as V,h as s,w as _,g as k,p as I,k as N,f as c}from"./index.bab7347b.2022_10_27_06_59_31.js";import"./pako.esm.f80f5d13.js";const{zip:X,unzip:m}=T,l="b_dataSource",B={name:"keepAlive",components:{list:y,tagSelect:x},data(){return{isLoading:!1,current:1,vodid:"",dataSource:null,page:0,pageSize:20,list:[],timer:null,isLoad:!1,inputText:"",infiniteId:+new Date,db:null,value1:"vodid",value0:0,option2:[{text:"\u5012\u5E8F",value:0},{text:"\u6B63\u5E8F",value:1}]}},async created(){let t=weui.loading("loading");setTimeout(async()=>{try{let o=await P();window[l]=JSON.parse(m(o.data)),this.isLoad=!0,t.hide()}catch{t.hide(),setTimeout(()=>{this.loadAllData()},500)}})},computed:{option1(){let t=["vodid","createtime","updatetime","definition","commentcount","downcount_total","downnum","duration","scorenum","view_price","yearname","yearid"];return this.list.length&&Object.keys(this.list[0]).forEach(o=>{t.includes(o)||t.push(o)}),t.map(o=>({text:o,value:o}))}},watch:{page(){clearTimeout(this.timer),this.timer=setTimeout(()=>{console.log("load",this.page,this.value1,this.value0),this.list=this.getPageList(),this.page==1&&this.list.length&&(this.infiniteId=+new Date)},100)}},methods:{search(){console.log("search",this.inputText),this.inputText=="update"?weui.confirm("\u662F\u5426\u66F4\u65B0\u6E90\u6570\u636E",()=>{console.log("yes"),this.page=1,this.isLoading=!1,this.loadAllData(!0).then(()=>{this.infiniteId=+new Date,this.inputText=""})},()=>{console.log("no"),this.page=0,setTimeout(()=>{this.page=1},50)}):(this.page=0,setTimeout(()=>{this.page=1},50))},getPageList(){let t=window.b_dataSource;if(typeof t!="object")return[];let i=Object.keys(t).map(e=>t[e]).filter(e=>(e.coverpic=`${h.b_dataSource_url}/coverpic/${e.vodid}`,e.retcode_v=e.play_url_data?e.play_url_data.retcode:"99",this.inputText?(["vodid"].includes(this.value1)?[e.title,e[this.value1]]:[e[this.value1]]).some(a=>(a+"").toLowerCase().includes(this.inputText.toLowerCase())):!0)).sort((e,a)=>parseFloat(e[this.value1])==e[this.value1]&&parseFloat(a[this.value1])==a[this.value1]?this.value0==0?a[this.value1]-e[this.value1]:e[this.value1]-a[this.value1]:this.value0==0?a[this.value1].localeCompare(e[this.value1]):e[this.value1].localeCompare(a[this.value1])).slice(0,this.page*this.pageSize);return i.forEach(e=>{e.url=e.play_url_data?e.play_url_data.data.httpurl||e.play_url_data.data.httpurl_preview||e.play_url_data.retcode:""}),console.log("keys",i.map(e=>e[this.value1]).slice(0,this.pageSize)),i},async loadAllData(t){let o=weui.loading("downloading"),i=await b({url:["localhost","192.168"].some(a=>location.host.includes(a))&&!t?"./dataSource.txt":`${h.b_dataSource_url}/dataSource.txt`,onDownloadProgress:function(a){let n=O(a.loaded,2);console.log("progressEvent",n),o.querySelector(".weui-toast__content").innerText=n,a.lengthComputable;{let u=a.loaded/a.total*100;console.log("downLoadProgress",a.loaded,a.total,u)}}});await z(i.data);let e=JSON.parse(m(i.data));return window[l]=e,this.isLoad=!0,o.hide(),i},onRefresh(){this.page=1,this.isLoading=!1,setTimeout(()=>{this.infiniteId=+new Date})},infinite(t){this.page++;let o=this.list.length;setTimeout(()=>{o==this.list.length?(t.complete(),this.$toast("\u52A0\u8F7D\u5B8C\u6210")):t.loaded()},1e3)}}};function P(){var t=f();return t.get(l,l)}function z(t){var o=f();return o.put(l,{id:l,data:t})}function f(){var t=new L(l,1,{onupgradeneeded:o=>{console.log("onupgradeneeded");let i=o.target.result,e=l;i.objectStoreNames.contains(e)||i.createObjectStore(e,{keyPath:"id"})},onversionchange:o=>{}});return t}function O(t,o,i){var e;for(i=i||["B","K","M","G","TB"];(e=i.shift())&&t>1024;)t=t/1024;return(e==="B"?t:t.toFixed(o===void 0?2:o))+e}const p=t=>(I("data-v-7e4b7199"),t=t(),N(),t),A={key:0,class:"hot"},F=p(()=>c("div",{slot:"spinner"},"Loading...",-1)),K=p(()=>c("div",{slot:"no-more"},"No more message",-1)),U=p(()=>c("div",{slot:"no-results"},"No results message",-1));function J(t,o,i,e,a,n){const u=d("van-dropdown-item"),g=d("van-dropdown-menu"),v=d("van-search"),w=d("list"),S=d("infinite-loading");return a.isLoad?(C(),V("div",A,[s(g,null,{default:_(()=>[s(u,{modelValue:a.value1,"onUpdate:modelValue":o[0]||(o[0]=r=>a.value1=r),options:n.option1,onChange:n.search},null,8,["modelValue","options","onChange"]),s(u,{modelValue:a.value0,"onUpdate:modelValue":o[1]||(o[1]=r=>a.value0=r),options:a.option2,onChange:n.search},null,8,["modelValue","options","onChange"])]),_:1}),s(v,{modelValue:a.inputText,"onUpdate:modelValue":o[2]||(o[2]=r=>a.inputText=r),placeholder:"\u8BF7\u8F93\u5165\u641C\u7D22\u5173\u952E\u8BCD",onSearch:n.search},null,8,["modelValue","onSearch"]),s(w,{dataList:a.list,showKey:a.value1},null,8,["dataList","showKey"]),s(S,{onInfinite:n.infinite,identifier:a.infiniteId,ref:"infiniteLoading"},{default:_(()=>[F,K,U]),_:1},8,["onInfinite","identifier"])])):k("",!0)}const Y=D(B,[["render",J],["__scopeId","data-v-7e4b7199"]]);export{Y as default};
