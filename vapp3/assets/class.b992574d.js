import{_,M as c,o as n,c as u,F as v,r as k,f,w,a as L}from"./index.c209ee9e.2022_11_09_01_53_08.js";import{L as q}from"./index.b5af19f4.js";import{c as s}from"./config.c00927f2.js";import C from"./list.07e700ea.js";import S from"./tagSelect.9e94dab5.js";import{a as g}from"./axios.646f38c1.js";import"./index.92daa177.js";const B={components:{list:C,tagSelect:S},data(){return{loading:!1,finished:!1,page:0,identifier:0,vodrows:[],dataSource:{params:{},action:""},classList:[{key:"categories",query:"cateid",id:0},{key:"areas",query:"areaid",id:0},{key:"years",query:"yearid",id:0},{key:"definitions",query:"definition",id:0},{key:"durations",query:"duration",id:0},{key:"freetypes",query:"freetype",id:0},{key:"mosaics",query:"mosaic",id:0},{key:"langvoices",query:"langvoice",id:0},{key:"orders",query:"order",id:0}]}},computed:{tags(){let e=[];return this.classList.forEach(a=>{let o=this.dataSource[a.key];o&&e.push({items:[{id:0,title:"\u5168\u90E8"}].concat(o.map(t=>{let i=t.keyid||t.cateid||t.areaid||t.yearid;return{...t,id:i}})),id:a.id})}),e}},created(){this.loadBaseData()},methods:{tagClick(e,a){this.classList[e].id=this.tags[e].items[a].id,this.loadPageData(1),this.finished=!1},itemClick(e){e.spid&&uni.navigateTo({url:"./detail?spid="+e.spid})},infinite(){this.loading=!0,console.log("onReachBottom"),this.loadPageData(this.page+1)},loadBaseData(){g.request({url:s.origin+"/vod/recommend",params:s.query()}).then(e=>{console.log("success",e),e.status==200&&e.data.retcode==0?this.dataSource=e.data.data:window.$dialog.alert({title:e.data.errmsg||e.statusCode||"fail"})}).catch(e=>{window.$dialog.alert({title:e.message||"fail"})})},loadPageData(e){g({url:s.origin+"/vod/listing-"+this.classList.map(a=>a.id).join("-")+"-"+this.page,params:s.query()}).then(a=>{this.loading=!1,console.log("success",a),a.status==200&&a.data.retcode==0?(this.page=e,this.page==1?this.vodrows=a.data.data.vodrows:this.vodrows=this.vodrows.concat(a.data.data.vodrows),a.data.data.vodrows.length<16?this.finished=!0:this.loading=!1):(weui.topTips(a.data.errmsg||a.statusCode||"fail"),this.loading=!1)}).catch(a=>{this.loading=!1,weui.topTips(a.message||"fail")})}},watch:{classList:{deep:!0,handler(e){console.log("classList",e),this.page=0,this.vodrows=[],this.identifier=new Date().valueOf()}}}},D={class:"class"};function T(e,a,o,t,i,d){const h=c("tagSelect"),m=c("list"),p=q;return n(),u("div",D,[(n(!0),u(v,null,k(d.tags,(l,r)=>(n(),L(h,{ref_for:!0,ref:`tagSelect${r}`,dataSource:l,key:r,onTagClick:y=>d.tagClick(r,y)},null,8,["dataSource","onTagClick"]))),128)),f(p,{modelValue:i.loading,"onUpdate:modelValue":a[0]||(a[0]=l=>i.loading=l),finished:i.finished,"finished-text":"\u6CA1\u6709\u66F4\u591A\u4E86",onLoad:d.infinite,style:{"min-height":"50vh"}},{default:w(()=>[f(m,{dataList:i.vodrows},null,8,["dataList"])]),_:1},8,["modelValue","finished","onLoad"])])}const M=_(B,[["render",T],["__scopeId","data-v-d0c94438"]]);export{M as default};
