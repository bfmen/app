import{c as o}from"./config.c00927f2.js";import h from"./list.f0533285.js";import y from"./tagSelect.dfa1d3d5.js";import{_,r as n,o as d,c as l,F as k,b as v,h as w,a as u,g as q}from"./index.8b60447b.2022_10_27_15_02_16.js";const S={components:{list:h,tagSelect:y},data(){return{page:0,identifier:0,vodrows:[],dataSource:{params:{},action:""},classList:[{key:"categories",query:"cateid",id:0},{key:"areas",query:"areaid",id:0},{key:"years",query:"yearid",id:0},{key:"definitions",query:"definition",id:0},{key:"durations",query:"duration",id:0},{key:"freetypes",query:"freetype",id:0},{key:"mosaics",query:"mosaic",id:0},{key:"langvoices",query:"langvoice",id:0},{key:"orders",query:"order",id:0}]}},computed:{tags(){let e=[];return this.classList.forEach(a=>{let t=this.dataSource[a.key];t&&e.push({items:[{id:0,title:"\u5168\u90E8"}].concat(t.map(i=>{let s=i.keyid||i.cateid||i.areaid||i.yearid;return{...i,id:s}})),id:a.id})}),e}},created(){this.loadBaseData()},methods:{tagClick(e,a){let t=0;a?t=a[0]:t=this.$refs["tagSelect"+e][0].idx,this.classList[e].id=this.tags[e].items[t].id},itemClick(e){e.spid&&uni.navigateTo({url:"./detail?spid="+e.spid})},infinite(e){console.log("onReachBottom"),this.loadPageData(this.page+1,e)},loadBaseData(){this.$axios.request({url:o.origin+"/vod/recommend",params:o.query()}).then(e=>{console.log("success",e),e.status==200&&e.data.retcode==0?this.dataSource=e.data.data:weui.topTips(e.data.errmsg||e.statusCode||"fail")}).catch(e=>{weui.topTips(e.message||"fail")})},loadPageData(e,a){this.$axios.request({url:o.origin+"/vod/listing-"+this.classList.map(t=>t.id).join("-")+"-"+this.page,params:o.query()}).then(t=>{console.log("success",t),t.status==200&&t.data.retcode==0?(this.page=e,this.page==1?this.vodrows=t.data.data.vodrows:this.vodrows=this.vodrows.concat(t.data.data.vodrows),t.data.data.vodrows.length<16?a&&a.complete():a&&a.loaded()):(weui.topTips(t.data.errmsg||t.statusCode||"fail"),a&&a.loaded())}).catch(t=>{a&&a.loaded(),weui.topTips(t.message||"fail")})}},watch:{classList:{deep:!0,handler(e){console.log("classList",e),this.page=0,this.vodrows=[],this.identifier=new Date().valueOf()}}}},L={class:"class"};function C(e,a,t,i,s,r){const f=n("tagSelect"),g=n("list"),p=n("infinite-loading");return d(),l("div",L,[(d(!0),l(k,null,v(r.tags,(m,c)=>(d(),u(f,{ref_for:!0,ref:`tagSelect${c}`,dataSource:m,key:c,onTagClick:T=>r.tagClick(c,arguments)},null,8,["dataSource","onTagClick"]))),128)),w(g,{dataList:s.vodrows},null,8,["dataList"]),s.dataSource.action?(d(),u(p,{key:0,identifier:s.identifier,onInfinite:r.infinite,ref:"infiniteLoading"},null,8,["identifier","onInfinite"])):q("",!0)])}const I=_(S,[["render",C],["__scopeId","data-v-2d7b573c"]]);export{I as default};
