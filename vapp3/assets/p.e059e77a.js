import{c as u}from"./config.c00927f2.js";import b from"./list.5b720606.js";import x from"./tagSelect.e5272a58.js";import{a as y}from"./axios.91e25212.js";import{z as T}from"./zip.8189dec6.js";import{D as L}from"./index.23b46475.js";import{_ as D,r as d,o as C,c as V,h as l,w as m,g as I,p as k,k as N,f as p}from"./index.bab7347b.2022_10_27_06_59_31.js";import"./pako.esm.f80f5d13.js";const{zip:X,unzip:g}=T,n="p_dataSource",B={name:"keepAlive",components:{list:b,tagSelect:x},data(){return{isLoading:!1,current:1,vodid:"",dataSource:null,page:0,pageSize:20,list:[],timer:null,isLoad:!1,inputText:"",infiniteId:+new Date,db:null,value1:"vodid",value0:0,option2:[{text:"\u5012\u5E8F",value:0},{text:"\u6B63\u5E8F",value:1}]}},async created(){let t=weui.loading("loading");setTimeout(async()=>{try{let o=await P();window[n]=o.data,this.isLoad=!0,t.hide()}catch{t.hide(),setTimeout(()=>{this.loadAllData()},500)}})},computed:{option1(){let t=["vodid","downnum"];return this.list.length&&Object.keys(this.list[0]).forEach(o=>{t.includes(o)||t.push(o)}),t.map(o=>({text:o,value:o}))}},watch:{page(){clearTimeout(this.timer),this.timer=setTimeout(()=>{console.log("load",this.page,this.value1,this.value0),this.list=this.getPageList(),this.page==1&&this.list.length&&(this.infiniteId=+new Date)},100)}},methods:{search(){console.log("search",this.inputText),this.inputText=="update"?weui.confirm("\u662F\u5426\u66F4\u65B0\u6E90\u6570\u636E",()=>{console.log("yes"),this.page=1,this.isLoading=!1,this.loadAllData(!0).then(()=>{this.infiniteId=+new Date,this.inputText=""})},()=>{console.log("no"),this.page=0,setTimeout(()=>{this.page=1},50)}):(this.page=0,setTimeout(()=>{this.page=1},50))},getPageList(){let t=JSON.parse(g(window[n]));if(typeof t!="object")return[];let i=Object.keys(t).map(e=>({...t[e],vodid:e})).filter(e=>{e.coverpic=`${u.p_dataSource_url}/pornstars/img/${e.vodid}.jpg`;let a=`${u.p_dataSource_url}/pornstars/webm/${e.vodid}.webm`;return e.url=a,e.play_url_data={url:a},e.retcode_v=1,this.inputText?(["vodid"].includes(this.value1)?[e.title,e[this.value1]]:[e[this.value1]]).some(s=>(s+"").toLowerCase().includes(this.inputText.toLowerCase())):!0}).sort((e,a)=>parseFloat(e[this.value1])==e[this.value1]&&parseFloat(a[this.value1])==a[this.value1]?this.value0==0?a[this.value1]-e[this.value1]:e[this.value1]-a[this.value1]:this.value0==0?a[this.value1].localeCompare(e[this.value1]):e[this.value1].localeCompare(a[this.value1])).slice(0,this.page*this.pageSize);return console.log("keys",i.map(e=>e[this.value1]).slice(0,this.pageSize)),i},async loadAllData(t){let o=weui.loading("downloading"),i=await y({url:`${u.p_dataSource_url}/pornstars/list.txt`,onDownloadProgress:function(e){let a=O(e.loaded,2);console.log("progressEvent",a),o.querySelector(".weui-toast__content").innerText=a,e.lengthComputable;{let s=e.loaded/e.total*100;console.log("downLoadProgress",e.loaded,e.total,s)}}});return await z(i.data),JSON.parse(g(i.data)),window[n]=i.data,this.isLoad=!0,o.hide(),i},onRefresh(){this.page=1,this.isLoading=!1,setTimeout(()=>{this.infiniteId=+new Date})},infinite(t){this.page++;let o=this.list.length;setTimeout(()=>{o==this.list.length?(t.complete(),this.$toast("\u52A0\u8F7D\u5B8C\u6210")):t.loaded()},1e3)}}};function P(){var t=f();return t.get(n,n)}function z(t){var o=f();return o.put(n,{id:n,data:t})}function f(){var t=new L(n,1,{onupgradeneeded:o=>{console.log("onupgradeneeded");let i=o.target.result,e=n;i.objectStoreNames.contains(e)||i.createObjectStore(e,{keyPath:"id"})},onversionchange:o=>{}});return t}function O(t,o,i){var e;for(i=i||["B","K","M","G","TB"];(e=i.shift())&&t>1024;)t=t/1024;return(e==="B"?t:t.toFixed(o===void 0?2:o))+e}const h=t=>(k("data-v-fbda6b69"),t=t(),N(),t),A={key:0,class:"hot"},F=h(()=>p("div",{slot:"spinner"},"Loading...",-1)),K=h(()=>p("div",{slot:"no-more"},"No more message",-1)),U=h(()=>p("div",{slot:"no-results"},"No results message",-1));function J(t,o,i,e,a,s){const c=d("van-dropdown-item"),v=d("van-dropdown-menu"),_=d("van-search"),w=d("list"),S=d("infinite-loading");return a.isLoad?(C(),V("div",A,[l(v,null,{default:m(()=>[l(c,{modelValue:a.value1,"onUpdate:modelValue":o[0]||(o[0]=r=>a.value1=r),options:s.option1,onChange:s.search},null,8,["modelValue","options","onChange"]),l(c,{modelValue:a.value0,"onUpdate:modelValue":o[1]||(o[1]=r=>a.value0=r),options:a.option2,onChange:s.search},null,8,["modelValue","options","onChange"])]),_:1}),l(_,{modelValue:a.inputText,"onUpdate:modelValue":o[2]||(o[2]=r=>a.inputText=r),placeholder:"\u8BF7\u8F93\u5165\u641C\u7D22\u5173\u952E\u8BCD",onSearch:s.search},null,8,["modelValue","onSearch"]),l(w,{dataList:a.list,showKey:a.value1},null,8,["dataList","showKey"]),l(S,{onInfinite:s.infinite,identifier:a.infiniteId,ref:"infiniteLoading"},{default:m(()=>[F,K,U]),_:1},8,["onInfinite","identifier"])])):I("",!0)}const Y=D(B,[["render",J],["__scopeId","data-v-fbda6b69"]]);export{Y as default};
