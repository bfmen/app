import{c as u}from"./config.c00927f2.js";import{_ as v,o as c,c as d,f as n,F as g,b as m,l as w,t as h,g as p}from"./index.bab7347b.2022_10_27_06_59_31.js";const _={data(){return{rows:[],current:0,isShowMask:!0,options:{scrollY:!0},isVideoLoading:!1,isMoreLoading:!1}},computed:{currentItem(){return this.rows.length>0?this.rows[this.current]:null}},created(){console.log("created banana"),this.loadData(!0)},mounted(){},methods:{scroll(s){let e=this.$refs.scroll.scrollTop,r=this.$refs.scroll.clientHeight,t=Math.round(e/r);this.changePage(t)},touchend(s){},loadData(s){this.isMoreLoading=!0,this.$axios.request({url:u.origin+"/minivod/reqlist",params:u.query()}).then(e=>{if(this.isMoreLoading=!1,console.log("success",e),e.status==200&&e.data.retcode==0){var r=[];e.data.data.rows.map(t=>{t.vodrow&&t.vodrow.vodid&&(t.videoUrl="",r.push(t))}),s?(this.rows=r,this.changePage(0)):this.rows.push(r[0])}else weui.topTips(e.data.errmsg||e.statusCode||"fail")}).catch(e=>{this.isMoreLoading=!1,weui.topTips(e.message||"fail")})},clickHandler(s,e){this.isShowMask=!this.isShowMask},tipClick(s){this.$refs.video.play(),this.isShowMask=!this.isShowMask,s.stopPropagation()},changePage(s){const e=this.rows[s],r=e.vodrow.vodid;document&&(document.title=e.vodrow.title),this.current=s,!e.videoUrl&&!this.isVideoLoading?(this.isVideoLoading=!0,this.$axios.request({url:u.origin+"/minivod/reqplay/"+r,params:u.query()}).then(t=>{this.isVideoLoading=!1,console.log("success",t);var a=t.data.data.httpurl||t.data.data.httpurl_preview;a?(console.log(a),this.rows[s].videoUrl=a,setTimeout(()=>{this.$refs["content"+this.current][0].appendChild(this.$refs.video),this.$refs.video.play()},20)):weui.topTips(t.data.errmsg||t.statusCode||"fail")}).catch(t=>{this.isVideoLoading=!1,weui.topTips(t.message||"fail")})):this.$refs["content"+this.current][0].querySelector(".video")||this.$refs["content"+this.current][0].appendChild(this.$refs.video),s==this.rows.length-1&&!this.isMoreLoading&&this.loadData()}},watch:{}},k=["src","poster"],y=["onClick"],M={key:0,class:"itemContent"},C=["src"];function L(s,e,r,t,a,o){return c(),d("div",{class:"scroll",ref:"scroll",onScroll:e[1]||(e[1]=(...i)=>o.scroll&&o.scroll(...i)),onTouchend:e[2]||(e[2]=(...i)=>o.touchend&&o.touchend(...i))},[n("video",{class:"video",controls:"controls",ref:"video",playsinline:"",autoplay:"",src:o.currentItem&&o.currentItem.videoUrl,poster:o.currentItem&&o.currentItem.vodrow.coverpic},null,8,k),(c(!0),d(g,null,m(a.rows,(i,l)=>(c(),d("div",{class:"swiperItem",key:l,onClick:f=>o.clickHandler(i,l),ref_for:!0,ref:"index"+l},[Math.abs(l-a.current)<3?(c(),d("div",M,[n("div",{class:"content",ref_for:!0,ref:"content"+l},[n("img",{src:i.vodrow.coverpic,style:w(a.current==l?"filter: blur(20px);":"")},null,12,C)],512),a.isShowMask?(c(),d("div",{key:0,class:"mask",onClick:e[0]||(e[0]=(...f)=>o.tipClick&&o.tipClick(...f))},[n("div",null,"@"+h(i.user.nickname),1),n("div",null,h(i.vodrow.title),1),n("div",null,h(i.vodrow.updatetime),1)])):p("",!0)])):p("",!0)],8,y))),128))],544)}const T=v(_,[["render",L],["__scopeId","data-v-e0a0b9f0"]]);export{T as default};
