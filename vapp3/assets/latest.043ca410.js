import{_ as C,R as w,o as L,c as I,f as c,w as y,N as O,y as V,z,l as _}from"./index.daa3e381.2024_03_12_10_44_37.js";import"./index.41e944d2.js";import{S as B}from"./index.ed442963.js";import{D as N,a as P}from"./index.4964285e.js";import{c as b}from"./config.6caa491d.js";import K from"./list.15076523.js";import U from"./tagSelect.548969ae.js";import{a as M}from"./axios.bf9a55be.js";import{p as T}from"./pako.esm.45930777.js";import"./use-id.a151530b.js";import"./index.cf6fdeae.js";function q(n){let e=n.toString();return n?T.ungzip(J(e),{to:"string"}):""}function E(n){typeof n!="string"&&(n=JSON.stringify(n));const e=T.gzip(n);return F(e)}const R={unzip:q,zip:E};function F(n){for(var e="",a=0;a<n.length;a++)e+=String.fromCharCode(n[a]);return e}function J(n){for(var e=[],a=0,t=n.length;a<t;++a)e.push(n.charCodeAt(a));var o=new Uint8Array(e);return o}class f{constructor(e,a,{onupgradeneeded:t,onversionchange:o=this._onversionchange}={}){this._name=e,this._version=a,this._onupgradeneeded=t,this._onversionchange=o,this._db=null}get db(){return this._db}async open(){if(!this._db)return this._db=await new Promise((e,a)=>{let t=!1;setTimeout(()=>{t=!0,a(new Error("The open request was blocked and timed out"))},this.OPEN_TIMEOUT);const o=indexedDB.open(this._name,this._version);o.onerror=()=>a(o.error),o.onupgradeneeded=i=>{t?(o.transaction.abort(),i.target.result.close()):this._onupgradeneeded&&this._onupgradeneeded(i)},o.onsuccess=({target:i})=>{const s=i.result;t?s.close():(s.onversionchange=this._onversionchange.bind(this),e(s))}}),this}async getKey(e,a){return(await this.getAllKeys(e,a,1))[0]}async getAll(e,a,t){return await this.getAllMatching(e,{query:a,count:t})}async getAllKeys(e,a,t){return(await this.getAllMatching(e,{query:a,count:t,includeKeys:!0})).map(({key:o})=>o)}async getAllMatching(e,{index:a,query:t=null,direction:o="next",count:i,includeKeys:s}={}){return await this.transaction([e],"readonly",(l,d)=>{const h=l.objectStore(e),p=a?h.index(a):h,r=[];p.openCursor(t,o).onsuccess=({target:D})=>{const g=D.result;if(g){const{primaryKey:A,key:k,value:v}=g;r.push(s?{primaryKey:A,key:k,value:v}:v),i&&r.length>=i?d(r):g.continue()}else d(r)}})}async transaction(e,a,t){return await this.open(),await new Promise((o,i)=>{const s=this._db.transaction(e,a);s.onabort=({target:l})=>i(l.error),s.oncomplete=()=>o(),t(s,l=>o(l))})}async _call(e,a,t,...o){const i=(s,l)=>{s.objectStore(a)[e](...o).onsuccess=({target:d})=>{l(d.result)}};return await this.transaction([a],t,i)}_onversionchange(){this.close()}close(){this._db&&(this._db.close(),this._db=null)}static async deleteDatabase(e){await new Promise((a,t)=>{const o=indexedDB.deleteDatabase(e);o.onerror=({target:i})=>{t(i.error)},o.onblocked=()=>{t(new Error("Delete blocked"))},o.onsuccess=()=>{a()}})}}f.prototype.OPEN_TIMEOUT=2e3;(function(){const n={readonly:["get","count","getKey","getAll","getAllKeys"],readwrite:["add","put","clear","delete"]};for(const[e,a]of Object.entries(n))for(const t of a)t in IDBObjectStore.prototype&&(f.prototype[t]=async function(o,...i){return await this._call(t,o,e,...i)})})();const{zip:ce,unzip:S}=R,u="b_dataSource",j={name:"keepAlive",components:{list:K,tagSelect:U},data(){return{isLoading:!1,current:1,vodid:"",dataSource:null,page:0,pageSize:20,list:[],timer:null,isLoad:!1,inputText:"",infiniteId:+new Date,db:null,value1:"vodid",value0:0,option2:[{text:"\u5012\u5E8F",value:0},{text:"\u6B63\u5E8F",value:1}]}},async created(){let n=weui.loading("loading");setTimeout(async()=>{try{let e=await W();window[u]=JSON.parse(S(e.data)),this.isLoad=!0,n.hide()}catch{n.hide(),setTimeout(()=>{this.loadAllData()},500)}})},computed:{option1(){let n=["vodid","createtime","updatetime","definition","commentcount","downcount_total","downnum","duration","scorenum","view_price","yearname","yearid"];return this.list.length&&Object.keys(this.list[0]).forEach(e=>{n.includes(e)||n.push(e)}),n.map(e=>({text:e,value:e}))}},watch:{page(){clearTimeout(this.timer),this.timer=setTimeout(()=>{console.log("load",this.page,this.value1,this.value0),this.list=this.getPageList(),this.page==1&&this.list.length&&(this.infiniteId=+new Date)},100)}},methods:{search(){console.log("search",this.inputText),this.inputText=="update"?weui.confirm("\u662F\u5426\u66F4\u65B0\u6E90\u6570\u636E",()=>{console.log("yes"),this.page=1,this.isLoading=!1,this.loadAllData(!0).then(()=>{this.infiniteId=+new Date,this.inputText=""})},()=>{console.log("no"),this.page=0,setTimeout(()=>{this.page=1},50)}):(this.page=0,setTimeout(()=>{this.page=1},50))},getPageList(){let n=window.b_dataSource;if(typeof n!="object")return[];let a=Object.keys(n).map(t=>n[t]).filter(t=>(t.coverpic=`${b.b_dataSource_url}/coverpic/${t.vodid}`,t.retcode_v=t.play_url_data?t.play_url_data.retcode:"99",this.inputText?(["vodid"].includes(this.value1)?[t.title,t[this.value1]]:[t[this.value1]]).some(o=>(o+"").toLowerCase().includes(this.inputText.toLowerCase())):!0)).sort((t,o)=>parseFloat(t[this.value1])==t[this.value1]&&parseFloat(o[this.value1])==o[this.value1]?this.value0==0?o[this.value1]-t[this.value1]:t[this.value1]-o[this.value1]:this.value0==0?o[this.value1].localeCompare(t[this.value1]):t[this.value1].localeCompare(o[this.value1])).slice(0,this.page*this.pageSize);return a.forEach(t=>{t.url=t.play_url_data?t.play_url_data.data.httpurl||t.play_url_data.data.httpurl_preview||t.play_url_data.retcode:""}),console.log("keys",a.map(t=>t[this.value1]).slice(0,this.pageSize)),a},async loadAllData(n){let e=weui.loading("downloading"),a=await M({url:["localhost","192.168"].some(o=>location.host.includes(o))&&!n?"./dataSource.txt":`${b.b_dataSource_url}/dataSource.txt`,onDownloadProgress:function(o){let i=H(o.loaded,2);console.log("progressEvent",i),e.querySelector(".weui-toast__content").innerText=i,o.lengthComputable;{let s=o.loaded/o.total*100;console.log("downLoadProgress",o.loaded,o.total,s)}}});await G(a.data);let t=JSON.parse(S(a.data));return window[u]=t,this.isLoad=!0,e.hide(),a},onRefresh(){this.page=1,this.isLoading=!1,setTimeout(()=>{this.infiniteId=+new Date})},infinite(n){this.page++;let e=this.list.length;setTimeout(()=>{e==this.list.length?(n.complete(),this.$toast("\u52A0\u8F7D\u5B8C\u6210")):n.loaded()},1e3)}}};function W(){var n=x();return n.get(u,u)}function G(n){var e=x();return e.put(u,{id:u,data:n})}function x(){var n=new f(u,1,{onupgradeneeded:e=>{console.log("onupgradeneeded");let a=e.target.result,t=u;a.objectStoreNames.contains(t)||a.createObjectStore(t,{keyPath:"id"})},onversionchange:e=>{}});return n}function H(n,e,a){var t;for(a=a||["B","K","M","G","TB"];(t=a.shift())&&n>1024;)n=n/1024;return(t==="B"?n:n.toFixed(e===void 0?2:e))+t}const m=n=>(V("data-v-7e4b7199"),n=n(),z(),n),Q={key:0,class:"hot"},X=m(()=>_("div",{slot:"spinner"},"Loading...",-1)),Y=m(()=>_("div",{slot:"no-more"},"No more message",-1)),Z=m(()=>_("div",{slot:"no-results"},"No results message",-1));function $(n,e,a,t,o,i){const s=N,l=P,d=B,h=w("list"),p=w("infinite-loading");return o.isLoad?(L(),I("div",Q,[c(l,null,{default:y(()=>[c(s,{modelValue:o.value1,"onUpdate:modelValue":e[0]||(e[0]=r=>o.value1=r),options:i.option1,onChange:i.search},null,8,["modelValue","options","onChange"]),c(s,{modelValue:o.value0,"onUpdate:modelValue":e[1]||(e[1]=r=>o.value0=r),options:o.option2,onChange:i.search},null,8,["modelValue","options","onChange"])]),_:1}),c(d,{modelValue:o.inputText,"onUpdate:modelValue":e[2]||(e[2]=r=>o.inputText=r),placeholder:"\u8BF7\u8F93\u5165\u641C\u7D22\u5173\u952E\u8BCD",onSearch:i.search},null,8,["modelValue","onSearch"]),c(h,{dataList:o.list,showKey:o.value1},null,8,["dataList","showKey"]),c(p,{onInfinite:i.infinite,identifier:o.infiniteId,ref:"infiniteLoading"},{default:y(()=>[X,Y,Z]),_:1},8,["onInfinite","identifier"])])):O("",!0)}const he=C(j,[["render",$],["__scopeId","data-v-7e4b7199"]]);export{he as default};
