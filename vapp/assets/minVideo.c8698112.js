import{c as a}from"./config.959b753b.js";import{n as l}from"./index.d02ca3cd.js";var c=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{ref:"scroll",staticClass:"scroll",on:{scroll:t.scroll,touchend:t.touchend}},[e("video",{ref:"video",staticClass:"video",attrs:{controls:"controls",playsinline:"",autoplay:"",src:t.currentItem&&t.currentItem.videoUrl,poster:t.currentItem&&t.currentItem.vodrow.coverpic}}),t._l(t.rows,function(o,r){return e("div",{key:r,ref:"index"+r,refInFor:!0,staticClass:"swiperItem",on:{click:function(f){return t.clickHandler(o,r)}}},[Math.abs(r-t.current)<3?e("div",{staticClass:"itemContent"},[e("div",{ref:"content"+r,refInFor:!0,staticClass:"content"},[e("img",{style:t.current==r?"filter: blur(20px);":"",attrs:{src:o.vodrow.coverpic}})]),t.isShowMask?e("div",{staticClass:"mask",on:{click:t.tipClick}},[e("div",[t._v("@"+t._s(o.user.nickname))]),e("div",[t._v(t._s(o.vodrow.title))]),e("div",[t._v(t._s(o.vodrow.updatetime))])]):t._e()]):t._e()])})],2)},d=[];const u={data(){return{rows:[],current:0,isShowMask:!0,options:{scrollY:!0},isVideoLoading:!1,isMoreLoading:!1}},computed:{currentItem(){return this.rows.length>0?this.rows[this.current]:null}},created(){console.log("created banana"),this.loadData(!0)},mounted(){},methods:{scroll(s){let t=this.$refs.scroll.scrollTop,i=this.$refs.scroll.clientHeight,e=Math.round(t/i);this.changePage(e)},touchend(s){},loadData(s){this.isMoreLoading=!0,this.$axios.request({url:a.origin+"/minivod/reqlist",params:a.query()}).then(t=>{if(this.isMoreLoading=!1,console.log("success",t),t.status==200&&t.data.retcode==0){var i=[];t.data.data.rows.map(e=>{e.vodrow&&e.vodrow.vodid&&(e.videoUrl="",i.push(e))}),s?(this.rows=i,this.changePage(0)):this.rows.push(i[0])}else weui.topTips(t.data.errmsg||t.statusCode||"fail")}).catch(t=>{this.isMoreLoading=!1,weui.topTips(t.message||"fail")})},clickHandler(s,t){this.isShowMask=!this.isShowMask},tipClick(s){this.$refs.video.play(),this.isShowMask=!this.isShowMask,s.stopPropagation()},changePage(s){const t=this.rows[s],i=t.vodrow.vodid;document&&(document.title=t.vodrow.title),this.current=s,!t.videoUrl&&!this.isVideoLoading?(this.isVideoLoading=!0,this.$axios.request({url:a.origin+"/minivod/reqplay/"+i,params:a.query()}).then(e=>{this.isVideoLoading=!1,console.log("success",e);var o=e.data.data.httpurl||e.data.data.httpurl_preview;o?(console.log(o),this.rows[s].videoUrl=o,setTimeout(()=>{this.$refs["content"+this.current][0].appendChild(this.$refs.video),this.$refs.video.play()},20)):weui.topTips(e.data.errmsg||e.statusCode||"fail")}).catch(e=>{this.isVideoLoading=!1,weui.topTips(e.message||"fail")})):this.$refs["content"+this.current][0].querySelector(".video")||this.$refs["content"+this.current][0].appendChild(this.$refs.video),s==this.rows.length-1&&!this.isMoreLoading&&this.loadData()}},watch:{}},n={};var h=l(u,c,d,!1,v,"85001bd8",null,null);function v(s){for(let t in n)this[t]=n[t]}var m=function(){return h.exports}();export{m as default};
