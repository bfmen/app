import{c as o}from"./config.3d405634.js";import{n as p}from"./index.6aa3385c.js";var d=function(){var s=this,i=s.$createElement,l=s._self._c||i;return l("div",{staticClass:"pullup-down-slide-wrapper",style:"height:".concat(s.height)},[l("div",{ref:"pulldown",staticClass:"pulldown-wrapper"},[l("div",{directives:[{name:"show",rawName:"v-show",value:s.beforePullDown,expression:"beforePullDown"}]},[l("span",[s._v("Pull Down and refresh")])]),l("div",{directives:[{name:"show",rawName:"v-show",value:!s.beforePullDown,expression:"!beforePullDown"}]},[l("div",{directives:[{name:"show",rawName:"v-show",value:s.isPullingDown,expression:"isPullingDown"}]},[l("span",[s._v("Loading...")])]),l("div",{directives:[{name:"show",rawName:"v-show",value:!s.isPullingDown,expression:"!isPullingDown"}]},[l("span",[s._v("Refresh success")])])])]),l("div",{ref:"bsWrapper",staticClass:"pullup-pulldown-slide-bswrapper"},[l("div",{staticClass:"pullup-pulldown-slide-scroller"},s._l(s.rows,function(t,a){var r;return l("div",{key:t.vodrow.vodid,staticClass:"pullup-pulldown-slide-item",class:(r={},r["page"+a%4]=!0,r),on:{click:function(P){return s.itemClick(t)}}},[l("div",{staticStyle:{"line-height":"initial","font-size":"initial"}},[l("div",[l("span",[s._v(s._s(t.vodrow.title))]),l("span",[s._v("/")]),l("span",[s._v(s._s(t.vodrow.scorenum))]),l("span",[s._v("/")]),l("span",[s._v(s._s(t.vodrow.playcount_total))]),l("span",[s._v("/")]),l("span",[s._v(s._s(t.vodrow.downcount_total))])]),l("div",[l("span",[s._v("@"+s._s(t.user.nickname))]),l("span",[s._v("/")]),l("span",[s._v(s._s(t.vodrow.updatetime))])])]),Math.abs(s.pageY-a)<=1?l("video",{ref:"video",refInFor:!0,staticClass:"video",style:s.pageY!=a?"filter: blur(10px);":"",attrs:{id:t.vodrow.vodid,controls:"controls",playsinline:"",autoplay:s.pageY==a,width:"100%",src:t.videoUrl,poster:t.vodrow&&t.vodrow.coverpic}}):l("van-image",{attrs:{fit:"cover",width:"100%",height:"100%",src:t.vodrow.coverpic}})],1)}),0)]),l("div",{ref:"pullup",staticClass:"pullup-wrapper"},[l("div",{directives:[{name:"show",rawName:"v-show",value:!s.isPullingUp,expression:"!isPullingUp"}]},[l("span",[s._v("Pull Up and load")])]),l("div",{directives:[{name:"show",rawName:"v-show",value:s.isPullingUp,expression:"isPullingUp"}]},[l("span",[s._v("Loading...")])])])])},c=[];const n=2,v=700,w=1e3,u=50,f=56,g={data(){return{beforePullDown:!0,isPullingDown:!1,isPullingUp:!1,dataList:new Array(n),stopPullup:!1,height:"100vh",pageY:0,rows:[],bscroll:null}},computed:{currentItem(){return this.rows.length?this.rows[this.pageY]:null}},watch:{pageY(){this.videoUrlUpdate(),this.pageY==this.rows.length-2&&this.loadData(!1)},rows(){this.videoUrlUpdate()}},created(){this.height=window.innerHeight+"px",this.bscroll=null,this.loadData(!0),window.onresize=()=>{this.height=window.innerHeight+"px",this.$nextTick(()=>{this.bscroll.refresh()})}},mounted(){this.initBscroll()},methods:{async itemClick(e){},loadData(e){return this.$axios.request({url:o.origin+"/minivod/reqlist",params:o.query()}).then(s=>{if(console.log("success",s),s.status==200&&s.data.retcode==0){var i=[];s.data.data.rows.map(l=>{l.vodrow&&l.vodrow.vodid&&(l.videoUrl="",i.push(l))}),e?this.rows=i:this.rows.push(...i),this.$nextTick(()=>{this.initBscroll(),this.bscroll.refresh()})}else weui.topTips(s.data.errmsg||s.statusCode||"fail")}).catch(s=>{this.isMoreLoading=!1,weui.topTips(s.message||"fail")})},videoUrlUpdate(){document.title=this.rows[this.pageY].vodrow.title,this.$nextTick(()=>{this.$refs.video.forEach(e=>{e.id==this.currentItem.vodrow.vodid?e.play():e.pause()})}),this.rows.filter((e,s)=>Math.abs(this.pageY-s)<=1).forEach(e=>{e.videoUrl||this.$axios.request({url:o.origin+e.vodrow.play_url,params:o.query()}).then(s=>{e.videoUrl=s.data.data.httpurl||s.data.data.httpurl_preview})})},initBscroll(){this.bscroll||!this.rows.length||(this.bscroll=BetterScroll.createBScroll(this.$refs.bsWrapper,{scrollY:!0,bounceTime:v,momentum:!1,click:!0,pullDownRefresh:{threshold:u,stop:f},pullUpLoad:{threshold:-u},slide:{threshold:5,disableSetHeight:!0,autoplay:!1,loop:!1}}),window.bscroll=this.bscroll,this.bscroll.on("pullingDown",this.pullingDownHandler),this.bscroll.on("pullingUp",this.pullingUpHandler),this.bscroll.on("scroll",this.scrollHandler),this.bscroll.on("slidePageChanged",this.slidePageChanged))},slidePageChanged({pageY:e}){this.pageY=e},scrollHandler(e){if(e.y>=0){const l=this.$refs.pulldown,{height:t}=getComputedStyle(l,null);l.style.transform=`translateY(${-parseInt(t)+e.y}px) translateZ(0)`}const s=-30,i=this.bscroll.maxScrollY;if(e.y-i<=s&&this.isPullingUp&&(this.stopPullup=!0),e.y-i<=0&&!this.stopPullup){const l=this.$refs.pullup;getComputedStyle(l,null),l.style.transform=`translateY(${e.y-i}px) translateZ(0)`}},async pullingDownHandler(){this.beforePullDown=!1,this.isPullingDown=!0,this.bscroll.enabled=!1,await this.loadData(!0),this.isPullingDown=!1,this.$nextTick(()=>{this.bscroll.finishPullDown(),this.beforePullDown=!0,this.bscroll.enabled=!0,this.bscroll.refresh()})},async pullingUpHandler(){this.isPullingUp=!0,this.bscroll.enabled=!1,await this.loadData(!1),this.$nextTick(()=>{this.isPullingUp=!1,this.bscroll.finishPullUp(),this.bscroll.enabled=!0,this.bscroll.refresh(),this.resetPullupPos()})},async requestData(e){try{const s=await this.ajaxGet();e==="load"?this.dataList=s.concat(this.dataList):this.dataList=s}catch(s){console.log(s)}},ajaxGet(){return new Promise(e=>{setTimeout(()=>{const s=new Array(n);e(s)},w)})},resetPullupPos(){const e=this.$refs.pullup;e.style.transform="translateY(0px) translateZ(0)",e.style.transition="transform 0.5s",this.stopPullup=!1}}},h={};var _=p(g,d,c,!1,b,"b5780908",null,null);function b(e){for(let s in h)this[s]=h[s]}var U=function(){return _.exports}();export{U as default};
