var f=Object.defineProperty,p=Object.defineProperties;var g=Object.getOwnPropertyDescriptors;var d=Object.getOwnPropertySymbols;var h=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable;var n=(e,t,i)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,c=(e,t)=>{for(var i in t||(t={}))h.call(t,i)&&n(e,i,t[i]);if(d)for(var i of d(t))m.call(t,i)&&n(e,i,t[i]);return e},l=(e,t)=>p(e,g(t));import{c as s}from"./config.959b753b.js";import _ from"./list.b73aba3b.js";import y from"./tagSelect.787ec351.js";import{n as v}from"./index.9fbadcc0.js";import"./array-method-has-species-support.3d205d52.js";var k=function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("div",{staticClass:"class"},[t._l(t.tags,function(o,r){return a("tagSelect",{key:r,ref:"tagSelect".concat(r),refInFor:!0,attrs:{dataSource:o},on:{tagClick:function(D){return t.tagClick(r,arguments)}}})}),a("list",{attrs:{dataList:t.vodrows}}),t.dataSource.action?a("infinite-loading",{ref:"infiniteLoading",attrs:{identifier:t.identifier},on:{infinite:t.infinite}}):t._e()],2)},w=[];const q={components:{list:_,tagSelect:y},data(){return{page:0,identifier:0,vodrows:[],dataSource:{params:{},action:""},classList:[{key:"categories",query:"cateid",id:0},{key:"areas",query:"areaid",id:0},{key:"years",query:"yearid",id:0},{key:"definitions",query:"definition",id:0},{key:"durations",query:"duration",id:0},{key:"freetypes",query:"freetype",id:0},{key:"mosaics",query:"mosaic",id:0},{key:"langvoices",query:"langvoice",id:0},{key:"orders",query:"order",id:0}]}},computed:{tags(){let e=[];return this.classList.forEach(t=>{let i=this.dataSource[t.key];i&&e.push({items:[{id:0,title:"\u5168\u90E8"}].concat(i.map(a=>{let o=a.keyid||a.cateid||a.areaid||a.yearid;return l(c({},a),{id:o})})),id:t.id})}),e}},created(){this.loadBaseData()},methods:{tagClick(e,t){let i=0;t?i=t[0]:i=this.$refs["tagSelect"+e][0].idx,this.classList[e].id=this.tags[e].items[i].id},itemClick(e){e.spid&&uni.navigateTo({url:"./detail?spid="+e.spid})},infinite(e){console.log("onReachBottom"),this.loadPageData(this.page+1,e)},loadBaseData(){this.$axios.request({url:s.origin+"/vod/recommend",params:s.query()}).then(e=>{console.log("success",e),e.status==200&&e.data.retcode==0?this.dataSource=e.data.data:weui.topTips(e.data.errmsg||e.statusCode||"fail")}).catch(e=>{weui.topTips(e.message||"fail")})},loadPageData(e,t){this.$axios.request({url:s.origin+"/vod/listing-"+this.classList.map(i=>i.id).join("-")+"-"+this.page,params:s.query()}).then(i=>{console.log("success",i),i.status==200&&i.data.retcode==0?(this.page=e,this.page==1?this.vodrows=i.data.data.vodrows:this.vodrows=this.vodrows.concat(i.data.data.vodrows),i.data.data.vodrows.length<16?t&&t.complete():t&&t.loaded()):(weui.topTips(i.data.errmsg||i.statusCode||"fail"),t&&t.loaded())}).catch(i=>{t&&t.loaded(),weui.topTips(i.message||"fail")})}},watch:{classList:{deep:!0,handler(e){console.log("classList",e),this.page=0,this.vodrows=[],this.identifier=new Date().valueOf()}}}},u={};var S=v(q,k,w,!1,C,"2b8a5772",null,null);function C(e){for(let t in u)this[t]=u[t]}var P=function(){return S.exports}();export{P as default};
