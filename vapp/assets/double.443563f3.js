import{H as v}from"./HelloWorld.49f82abb.js";import{m as y,n as _}from"./index.e6b98e19.js";var C=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"home"},[e("div",{staticClass:"inputArea"},[e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u5E01\u79CD")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.currencys,callback:function(l){t.$set(t.config,"currencys",l)},expression:"config.currencys"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u5468\u671F")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.period,callback:function(l){t.$set(t.config,"period",l)},expression:"config.period"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u6570\u91CF")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.size,callback:function(l){t.$set(t.config,"size",l)},expression:"config.size"}})],1)]),e("div",{staticClass:"buttons"},[e("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.getData}},[t._v("\u83B7\u53D6\u6570\u636E")]),e("el-button",{attrs:{type:"primary"},on:{click:function(l){return t.testClick()}}},[t._v(t._s(t.spotData.id||"\u83B7\u53D6\u8D26\u6237ID"))]),e("el-button",{attrs:{type:"primary"},on:{click:function(l){return t.testClick2()}}},[t._v("\u6D4B\u8BD52")]),e("el-button",{attrs:{type:"danger"},on:{click:function(l){t.$store.state.klineData=[]}}},[t._v("\u5220\u9664\u7F51\u7EDC\u6570\u636E")])],1),e("div",{staticClass:"data"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[e("el-table-column",{attrs:{prop:"currency",label:"currency",width:"80"}}),e("el-table-column",{attrs:{prop:"period",label:"period",width:"80"}}),e("el-table-column",{attrs:{prop:"price",label:"price",width:"80"}}),e("el-table-column",{attrs:{prop:"start",label:"start",width:"165"}}),e("el-table-column",{attrs:{prop:"end",label:"end",width:"165"}}),e("el-table-column",{attrs:{prop:"time",label:"time",width:"165"}}),e("el-table-column",{attrs:{prop:"length",label:"length"}}),e("el-table-column",{attrs:{fixed:"right",label:"\u64CD\u4F5C",width:"80"},scopedSlots:t._u([{key:"default",fn:function(l){return[e("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(r){return t.$store.state.klineData.splice(l.$index,1)}}},[t._v("\u5220\u9664")])]}}])})],1)],1),e("el-divider"),e("div",{staticClass:"inputArea"},[e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u9ED8\u8BA4U\u989D")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.assetsAll,callback:function(l){t.$set(t.config,"assetsAll",l)},expression:"config.assetsAll"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u6BCF\u7B14\u4EA4\u6613\u989D")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.assetsSplit,callback:function(l){t.$set(t.config,"assetsSplit",l)},expression:"config.assetsSplit"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u5E73\u8861\u503C")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.assetsScale,callback:function(l){t.$set(t.config,"assetsScale",l)},expression:"config.assetsScale"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u4EA4\u6613\u6761\u4EF6")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.riseKey,callback:function(l){t.$set(t.config,"riseKey",l)},expression:"config.riseKey"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u71C3\u6599\u8D39")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.gas,callback:function(l){t.$set(t.config,"gas",l)},expression:"config.gas"}})],1)]),e("div",{staticClass:"buttons"},[e("el-button",{attrs:{type:"primary",loading:t.loading2},on:{click:function(l){return t.calculateDouble(t.klineData)}}},[t._v("\u8BA1\u7B97")]),e("el-button",{attrs:{type:"primary"},on:{click:function(l){return t.testClick(t.klineData)}}},[t._v("\u6D4B\u8BD5\u70B9\u51FB")]),e("el-button",{attrs:{type:"danger"},on:{click:function(l){t.$store.state.ccData=[]}}},[t._v("\u5220\u9664\u8BA1\u7B97\u6570\u636E")])],1),e("div",{staticClass:"data"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading2,expression:"loading2"}],staticStyle:{width:"100%"},attrs:{data:t.ccData,border:""}},[e("el-table-column",{attrs:{prop:"time",label:"time",width:"165"}}),e("el-table-column",{attrs:{prop:"currency",label:"currency",width:"100"}}),e("el-table-column",{attrs:{prop:"period",label:"period"}}),e("el-table-column",{attrs:{prop:"assetsAll",label:"\u672C\u91D1"}}),e("el-table-column",{attrs:{prop:"change",label:"change",sortable:""}}),e("el-table-column",{attrs:{prop:"rate",label:"rate",sortable:""}}),e("el-table-column",{attrs:{prop:"assetsSplit",label:"assetsSplit"}}),e("el-table-column",{attrs:{prop:"assetsScale",label:"assetsScale"}}),e("el-table-column",{attrs:{prop:"riseKey",label:"riseKey"}}),e("el-table-column",{attrs:{prop:"assets",label:"assets"}}),e("el-table-column",{attrs:{prop:"assets0",label:"assets0"}}),e("el-table-column",{attrs:{prop:"assets1",label:"assets1"}}),e("el-table-column",{attrs:{prop:"assetsNum0",label:"assetsNum0"}}),e("el-table-column",{attrs:{prop:"assetsNum1",label:"assetsNum1"}}),e("el-table-column",{attrs:{prop:"length",label:"length"}}),e("el-table-column",{attrs:{prop:"buyCount",label:"buyCount"}}),e("el-table-column",{attrs:{prop:"sellCount",label:"sellCount"}}),e("el-table-column",{attrs:{prop:"buyError",label:"buyError"}}),e("el-table-column",{attrs:{prop:"sellError",label:"sellError"}}),e("el-table-column",{attrs:{prop:"gas",label:"gas"}}),e("el-table-column",{attrs:{fixed:"right",label:"\u64CD\u4F5C",width:"80"},scopedSlots:t._u([{key:"default",fn:function(l){return[e("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(r){return t.$store.state.ccData.splice(l.$index,1)}}},[t._v("\u5220\u9664")])]}}])})],1)],1),e("el-divider")],1)},$=[];var w=window.axios;const k={name:"Home",components:{HelloWorld:v},data(){return{input:"",loading:!1,loading2:!1}},computed:{...y({config:t=>t.config,urls:t=>t.urls,klineData:t=>t.klineData,calculateData:t=>t.calculateData,ccData:t=>t.ccData,spotData:t=>t.accounts.filter(s=>s.type=="spot")[0]||{}}),currencys(){return this.config.currencys.split(",")},periods(){return this.config.period.split(",")},tableData(){return this.klineData.map(t=>({currency:t.currency,period:t.period,price:t.price,length:t.list.length,start:d(t.list[0].id*1e3),end:d(t.list[t.list.length-1].id*1e3),time:d()}))}},created(){},methods:{testClick(t){if(t.length==2){let e=t[0].list,l=t[1].list;for(const i in e)if(e[i].id!=l[i].id){this.$message.error("\u6570\u636E\u5BF9\u65F6\u95F4\u5F02\u5E38"+i);return}this.loading2=!0;let r=[this.config.assetsAll,this.config.assetsSplit,this.config.assetsScale,this.config.riseKey,this.config.gas].map(i=>{let a=[],o=String(i).split("-");if(o.length>1){let n=o[1].split("."),c=1;n.length>1&&(c=Math.pow(10,-n[1].length));let u=parseFloat(o[0]),p=u;for(a.push(u);parseFloat(a[a.length-1])<parseFloat(o[1]);)p=b(a[a.length-1]+c,c==1?0:n[1].length),a.push(p)}else a=o;return a});var s=new Worker("./work.js");s.postMessage({data:r,klineData:t}),s.onmessage=i=>{this.loading2=!1;let a=i.data;f("\u8BA1\u7B97\u5B8C\u6210",a.length),this.$store.state.ccData=a,s.terminate()}}else this.$message.error("\u8BF7\u9009\u62E9\u4E00\u5BF9\u6570\u636E")},testClick2(){function t(e){for(var l="",r=0;r<e.length;r++)l+=String.fromCharCode(e[r]);return l}var s=new WebSocket("wss://api.huobi.pro/ws");s.onopen=function(e){console.log("Connection open ..."),s.send("\u53D1\u9001\u7684\u6570\u636E"),s.send(JSON.stringify({req:"market.ethusdt.kline.1min",id:"id10",to:1621307580,from:1621307080}))},s.onmessage=function(e){var l=new FileReader;l.onload=function(r){var i=l.result;const o=require("pako").inflate(i);let n=t(o),c=JSON.parse(n);if(console.log(c),c.ping){let u=JSON.stringify({pong:c.ping});s.send(u)}},l.readAsArrayBuffer(e.data)},s.onclose=function(e){console.log("Connection closed.")}},handleClick(t,s){s==1?this.$store.state.calculateData=[...this.calculate1([this.klineData[t.$index]]),...this.$store.state.calculateData]:s==2&&this.$store.state.calculateData.splice(t.$index,1,this.calculate1([this.calculateData[t.$index].item])[0])},getData(){let t=this.currencys,s=this.periods,e=[],l=[];t.forEach(r=>{s.forEach(i=>{e.push(S(r,i,this.config,this.urls.klineUrl)),l.push({currency:r,period:i,list:[],price:0})})}),console.log(t),console.log(s),this.loading=!0,Promise.all(e).then(r=>{this.loading=!1,r.forEach((i,a)=>{l[a].list=[...i].reverse(),l[a].price=l[a].list[0].close}),this.$store.state.klineData=[...l,...this.$store.state.klineData]}).catch(r=>{console.log(r)})},async calculateDouble(t){if(t.length==2){let s=t[0].list,e=t[1].list;for(const a in s)if(s[a].id!=e[a].id){this.$message.error("\u6570\u636E\u5BF9\u65F6\u95F4\u5F02\u5E38"+a);return}this.loading2=!0;let l=[this.config.assetsAll,this.config.assetsSplit,this.config.assetsScale,this.config.riseKey,this.config.gas].map(a=>{let o=[],n=String(a).split("-");if(n.length>1){let c=n[1].split("."),u=1;c.length>1&&(u=Math.pow(10,-c[1].length));let p=parseFloat(n[0]),h=p;for(o.push(p);parseFloat(o[o.length-1])<parseFloat(n[1]);)h=b(o[o.length-1]+u,u==1?0:c[1].length),o.push(h)}else o=n;return o}),r=[];l[0].forEach(a=>{l[1].forEach(o=>{l[2].forEach(n=>{l[3].forEach(c=>{l[4].forEach(u=>{r.push([a,o,n,c,u])})})})})});let i=[];r.forEach(a=>{i.push(this.calculateDouble2(t,a[0],a[1],a[2],a[3],a[4]))}),f("\u8BA1\u7B97\u5B8C\u6210",i.length),this.loading2=!1,this.$store.state.ccData=i}else this.$message.error("\u8BF7\u9009\u62E9\u4E00\u5BF9\u6570\u636E")},calculateDouble2(t,s=100,e=5,l=1.2,r=.005,i=.002){e=parseFloat(e),l=parseFloat(l),r=parseFloat(r),i=parseFloat(i);let a={buyCount:0,sellCount:0,buyError:0,sellError:0,assets:parseFloat(s),assetsNum0:s/t[0].list[0].close,assetsNum1:s/t[1].list[0].close};t[0].list.forEach((n,c)=>{let u=t[0].list[c],p=t[1].list[c];this.calculateDouble3(u,"assetsNum0",a,s,e,l,r,i),this.calculateDouble3(p,"assetsNum1",a,s,e,l,r,i)});let o={currency:t[0].currency+","+t[1].currency,period:t[0].period,length:t[0].list.length,assets0:g(a.assetsNum0*t[0].list[t[0].list.length-1].close,2),assets1:g(a.assetsNum1*t[1].list[t[1].list.length-1].close,2),assetsAll:s,assetsSplit:e,assetsScale:l,riseKey:r,gas:i,...a,time:d(),assets:g(a.assets,2)};return o.change=g(o.assets+o.assets0+o.assets1-3*s,2),o.rate=o.change/(parseFloat(s)*3),o},calculateDouble3(t,s,e,l,r,i,a,o){let n=r*i,c=e[s]*t.close,u=(t.close-t.open)/t.open;if(Math.abs(u)>parseFloat(a))if(u>0){let p=c>e.assets?n:r,h=parseFloat(p)/t.close;e[s]>h?(e.assets+=parseFloat(p)*(1-parseFloat(o)),e[s]-=parseFloat(p)/t.close,e.sellCount++):e.sellError++}else{let p=c>e.assets?r:n;e.assets>p?(e.assets-=p,e[s]+=p/t.close*(1-parseFloat(o)),e.buyCount++):e.buyError++}}}};function S(t,s,e,l){let r=e.size,i={symbol:(t+"usdt").toLowerCase(),period:s,size:r};return new Promise((a,o)=>{w({method:"get",url:l,params:i}).then(n=>{let c=n.data.data;a(c)}).catch(n=>{f("\u9519\u8BEF:GetRecords",n),a([])})})}function d(t){return window.dayjs(t).format("YYYY-MM-DD HH:mm:ss")}function g(t,s=0){return Math.floor(t*Math.pow(10,s))/Math.pow(10,s)}function b(t,s=0){return Math.round(t*Math.pow(10,s))/Math.pow(10,s)}function f(){console.log(d(),...arguments)}const m={};var D=_(k,C,$,!1,x,null,null,null);function x(t){for(let s in m)this[s]=m[s]}var N=function(){return D.exports}();export{N as default};
