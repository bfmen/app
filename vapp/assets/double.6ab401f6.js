var k=Object.defineProperty,$=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var y=(l,t,a)=>t in l?k(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,b=(l,t)=>{for(var a in t||(t={}))S.call(t,a)&&y(l,a,t[a]);if(v)for(var a of v(t))D.call(t,a)&&y(l,a,t[a]);return l},f=(l,t)=>$(l,w(t));import{H as x}from"./es.array.splice.34e8c7df.js";import{m as F,n as E}from"./index.f23fb33b.js";import"./array-method-has-species-support.557be00f.js";var N=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"home"},[e("div",{staticClass:"inputArea"},[e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u5E01\u79CD")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.currencys,callback:function(s){t.$set(t.config,"currencys",s)},expression:"config.currencys"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u5468\u671F")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.period,callback:function(s){t.$set(t.config,"period",s)},expression:"config.period"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u6570\u91CF")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.size,callback:function(s){t.$set(t.config,"size",s)},expression:"config.size"}})],1)]),e("div",{staticClass:"buttons"},[e("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.getData}},[t._v("\u83B7\u53D6\u6570\u636E")]),e("el-button",{attrs:{type:"primary"},on:{click:function(s){return t.testClick()}}},[t._v(t._s(t.spotData.id||"\u83B7\u53D6\u8D26\u6237ID"))]),e("el-button",{attrs:{type:"primary"},on:{click:function(s){return t.testClick2()}}},[t._v("\u6D4B\u8BD52")]),e("el-button",{attrs:{type:"danger"},on:{click:function(s){t.$store.state.klineData=[]}}},[t._v("\u5220\u9664\u7F51\u7EDC\u6570\u636E")])],1),e("div",{staticClass:"data"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[e("el-table-column",{attrs:{prop:"currency",label:"currency",width:"80"}}),e("el-table-column",{attrs:{prop:"period",label:"period",width:"80"}}),e("el-table-column",{attrs:{prop:"price",label:"price",width:"80"}}),e("el-table-column",{attrs:{prop:"start",label:"start",width:"165"}}),e("el-table-column",{attrs:{prop:"end",label:"end",width:"165"}}),e("el-table-column",{attrs:{prop:"time",label:"time",width:"165"}}),e("el-table-column",{attrs:{prop:"length",label:"length"}}),e("el-table-column",{attrs:{fixed:"right",label:"\u64CD\u4F5C",width:"80"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(i){return t.$store.state.klineData.splice(s.$index,1)}}},[t._v("\u5220\u9664")])]}}])})],1)],1),e("el-divider"),e("div",{staticClass:"inputArea"},[e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u9ED8\u8BA4U\u989D")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.assetsAll,callback:function(s){t.$set(t.config,"assetsAll",s)},expression:"config.assetsAll"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u6BCF\u7B14\u4EA4\u6613\u989D")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.assetsSplit,callback:function(s){t.$set(t.config,"assetsSplit",s)},expression:"config.assetsSplit"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u5E73\u8861\u503C")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.assetsScale,callback:function(s){t.$set(t.config,"assetsScale",s)},expression:"config.assetsScale"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u4EA4\u6613\u6761\u4EF6")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.riseKey,callback:function(s){t.$set(t.config,"riseKey",s)},expression:"config.riseKey"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u71C3\u6599\u8D39")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.gas,callback:function(s){t.$set(t.config,"gas",s)},expression:"config.gas"}})],1)]),e("div",{staticClass:"buttons"},[e("el-button",{attrs:{type:"primary",loading:t.loading2},on:{click:function(s){return t.calculateDouble(t.klineData)}}},[t._v("\u8BA1\u7B97")]),e("el-button",{attrs:{type:"primary"},on:{click:function(s){return t.testClick(t.klineData)}}},[t._v("\u6D4B\u8BD5\u70B9\u51FB")]),e("el-button",{attrs:{type:"danger"},on:{click:function(s){t.$store.state.ccData=[]}}},[t._v("\u5220\u9664\u8BA1\u7B97\u6570\u636E")])],1),e("div",{staticClass:"data"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading2,expression:"loading2"}],staticStyle:{width:"100%"},attrs:{data:t.ccData,border:""}},[e("el-table-column",{attrs:{prop:"time",label:"time",width:"165"}}),e("el-table-column",{attrs:{prop:"currency",label:"currency",width:"100"}}),e("el-table-column",{attrs:{prop:"period",label:"period"}}),e("el-table-column",{attrs:{prop:"assetsAll",label:"\u672C\u91D1"}}),e("el-table-column",{attrs:{prop:"change",label:"change",sortable:""}}),e("el-table-column",{attrs:{prop:"rate",label:"rate",sortable:""}}),e("el-table-column",{attrs:{prop:"assetsSplit",label:"assetsSplit"}}),e("el-table-column",{attrs:{prop:"assetsScale",label:"assetsScale"}}),e("el-table-column",{attrs:{prop:"riseKey",label:"riseKey"}}),e("el-table-column",{attrs:{prop:"assets",label:"assets"}}),e("el-table-column",{attrs:{prop:"assets0",label:"assets0"}}),e("el-table-column",{attrs:{prop:"assets1",label:"assets1"}}),e("el-table-column",{attrs:{prop:"assetsNum0",label:"assetsNum0"}}),e("el-table-column",{attrs:{prop:"assetsNum1",label:"assetsNum1"}}),e("el-table-column",{attrs:{prop:"length",label:"length"}}),e("el-table-column",{attrs:{prop:"buyCount",label:"buyCount"}}),e("el-table-column",{attrs:{prop:"sellCount",label:"sellCount"}}),e("el-table-column",{attrs:{prop:"buyError",label:"buyError"}}),e("el-table-column",{attrs:{prop:"sellError",label:"sellError"}}),e("el-table-column",{attrs:{prop:"gas",label:"gas"}}),e("el-table-column",{attrs:{fixed:"right",label:"\u64CD\u4F5C",width:"80"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(i){return t.$store.state.ccData.splice(s.$index,1)}}},[t._v("\u5220\u9664")])]}}])})],1)],1),e("el-divider")],1)},M=[];var z=window.axios;const A={name:"Home",components:{HelloWorld:x},data(){return{input:"",loading:!1,loading2:!1}},computed:f(b({},F({config:l=>l.config,urls:l=>l.urls,klineData:l=>l.klineData,calculateData:l=>l.calculateData,ccData:l=>l.ccData,spotData:l=>l.accounts.filter(t=>t.type=="spot")[0]||{}})),{currencys(){return this.config.currencys.split(",")},periods(){return this.config.period.split(",")},tableData(){return this.klineData.map(l=>({currency:l.currency,period:l.period,price:l.price,length:l.list.length,start:d(l.list[0].id*1e3),end:d(l.list[l.list.length-1].id*1e3),time:d()}))}}),created(){},methods:{testClick(l){if(l.length==2){let a=l[0].list,e=l[1].list;for(const s in a)if(a[s].id!=e[s].id){this.$message.error("\u6570\u636E\u5BF9\u65F6\u95F4\u5F02\u5E38"+s);return}this.loading2=!0;let r=[this.config.assetsAll,this.config.assetsSplit,this.config.assetsScale,this.config.riseKey,this.config.gas].map(s=>{let o=[],i=String(s).split("-");if(i.length>1){let n=i[1].split("."),c=1;n.length>1&&(c=Math.pow(10,-n[1].length));let u=parseFloat(i[0]),p=u;for(o.push(u);parseFloat(o[o.length-1])<parseFloat(i[1]);)p=_(o[o.length-1]+c,c==1?0:n[1].length),o.push(p)}else o=i;return o});var t=new Worker("./work.js");t.postMessage({data:r,klineData:l}),t.onmessage=s=>{this.loading2=!1;let o=s.data;m("\u8BA1\u7B97\u5B8C\u6210",o.length),this.$store.state.ccData=o,t.terminate()}}else this.$message.error("\u8BF7\u9009\u62E9\u4E00\u5BF9\u6570\u636E")},testClick2(){function l(a){for(var e="",r=0;r<a.length;r++)e+=String.fromCharCode(a[r]);return e}var t=new WebSocket("wss://api.huobi.pro/ws");t.onopen=function(a){console.log("Connection open ..."),t.send("\u53D1\u9001\u7684\u6570\u636E"),t.send(JSON.stringify({req:"market.ethusdt.kline.1min",id:"id10",to:1621307580,from:1621307080}))},t.onmessage=function(a){var e=new FileReader;e.onload=function(r){var s=e.result;const i=require("pako").inflate(s);let n=l(i),c=JSON.parse(n);if(console.log(c),c.ping){let u=JSON.stringify({pong:c.ping});t.send(u)}},e.readAsArrayBuffer(a.data)},t.onclose=function(a){console.log("Connection closed.")}},handleClick(l,t){t==1?this.$store.state.calculateData=[...this.calculate1([this.klineData[l.$index]]),...this.$store.state.calculateData]:t==2&&this.$store.state.calculateData.splice(l.$index,1,this.calculate1([this.calculateData[l.$index].item])[0])},getData(){let l=this.currencys,t=this.periods,a=[],e=[];l.forEach(r=>{t.forEach(s=>{a.push(H(r,s,this.config,this.urls.klineUrl)),e.push({currency:r,period:s,list:[],price:0})})}),console.log(l),console.log(t),this.loading=!0,Promise.all(a).then(r=>{this.loading=!1,r.forEach((s,o)=>{e[o].list=[...s].reverse(),e[o].price=e[o].list[0].close}),this.$store.state.klineData=[...e,...this.$store.state.klineData]}).catch(r=>{console.log(r)})},async calculateDouble(l){if(l.length==2){let t=l[0].list,a=l[1].list;for(const o in t)if(t[o].id!=a[o].id){this.$message.error("\u6570\u636E\u5BF9\u65F6\u95F4\u5F02\u5E38"+o);return}this.loading2=!0;let e=[this.config.assetsAll,this.config.assetsSplit,this.config.assetsScale,this.config.riseKey,this.config.gas].map(o=>{let i=[],n=String(o).split("-");if(n.length>1){let c=n[1].split("."),u=1;c.length>1&&(u=Math.pow(10,-c[1].length));let p=parseFloat(n[0]),h=p;for(i.push(p);parseFloat(i[i.length-1])<parseFloat(n[1]);)h=_(i[i.length-1]+u,u==1?0:c[1].length),i.push(h)}else i=n;return i}),r=[];e[0].forEach(o=>{e[1].forEach(i=>{e[2].forEach(n=>{e[3].forEach(c=>{e[4].forEach(u=>{r.push([o,i,n,c,u])})})})})});let s=[];r.forEach(o=>{s.push(this.calculateDouble2(l,o[0],o[1],o[2],o[3],o[4]))}),m("\u8BA1\u7B97\u5B8C\u6210",s.length),this.loading2=!1,this.$store.state.ccData=s}else this.$message.error("\u8BF7\u9009\u62E9\u4E00\u5BF9\u6570\u636E")},calculateDouble2(l,t=100,a=5,e=1.2,r=.005,s=.002){a=parseFloat(a),e=parseFloat(e),r=parseFloat(r),s=parseFloat(s);let o={buyCount:0,sellCount:0,buyError:0,sellError:0,assets:parseFloat(t),assetsNum0:t/l[0].list[0].close,assetsNum1:t/l[1].list[0].close};l[0].list.forEach((n,c)=>{let u=l[0].list[c],p=l[1].list[c];this.calculateDouble3(u,"assetsNum0",o,t,a,e,r,s),this.calculateDouble3(p,"assetsNum1",o,t,a,e,r,s)});let i=f(b({currency:l[0].currency+","+l[1].currency,period:l[0].period,length:l[0].list.length,assets0:g(o.assetsNum0*l[0].list[l[0].list.length-1].close,2),assets1:g(o.assetsNum1*l[1].list[l[1].list.length-1].close,2),assetsAll:t,assetsSplit:a,assetsScale:e,riseKey:r,gas:s},o),{time:d(),assets:g(o.assets,2)});return i.change=g(i.assets+i.assets0+i.assets1-3*t,2),i.rate=i.change/(parseFloat(t)*3),i},calculateDouble3(l,t,a,e,r,s,o,i){let n=r*s,c=a[t]*l.close,u=(l.close-l.open)/l.open;if(Math.abs(u)>parseFloat(o))if(u>0){let p=c>a.assets?n:r,h=parseFloat(p)/l.close;a[t]>h?(a.assets+=parseFloat(p)*(1-parseFloat(i)),a[t]-=parseFloat(p)/l.close,a.sellCount++):a.sellError++}else{let p=c>a.assets?r:n;a.assets>p?(a.assets-=p,a[t]+=p/l.close*(1-parseFloat(i)),a.buyCount++):a.buyError++}}}};function H(l,t,a,e){let r=a.size,s={symbol:(l+"usdt").toLowerCase(),period:t,size:r};return new Promise((o,i)=>{z({method:"get",url:e,params:s}).then(n=>{let c=n.data.data;o(c)}).catch(n=>{m("\u9519\u8BEF:GetRecords",n),o([])})})}function d(l){return window.dayjs(l).format("YYYY-MM-DD HH:mm:ss")}function g(l,t=0){return Math.floor(l*Math.pow(10,t))/Math.pow(10,t)}function _(l,t=0){return Math.round(l*Math.pow(10,t))/Math.pow(10,t)}function m(){console.log(d(),...arguments)}const C={};var R=E(A,N,M,!1,j,null,null,null);function j(l){for(let t in C)this[t]=C[t]}var U=function(){return R.exports}();export{U as default};
