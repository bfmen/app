var k=Object.defineProperty,w=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var y=(l,t,s)=>t in l?k(l,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[t]=s,f=(l,t)=>{for(var s in t||(t={}))x.call(t,s)&&y(l,s,t[s]);if(v)for(var s of v(t))S.call(t,s)&&y(l,s,t[s]);return l},b=(l,t)=>w(l,$(t));import{H as D}from"./es.array.splice.9a1f6285.js";import{m as F,n as E}from"./index.aec38414.js";import"./array-method-has-species-support.f33995b6.js";var N=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"home"},[e("div",{staticClass:"inputArea"},[e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u5E01\u79CD")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.currencys,callback:function(a){t.$set(t.config,"currencys",a)},expression:"config.currencys"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u5468\u671F")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.period,callback:function(a){t.$set(t.config,"period",a)},expression:"config.period"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u6570\u91CF")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.size,callback:function(a){t.$set(t.config,"size",a)},expression:"config.size"}})],1)]),e("div",{staticClass:"buttons"},[e("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.getData}},[t._v("\u83B7\u53D6\u6570\u636E")]),e("el-button",{attrs:{type:"primary"},on:{click:function(a){return t.testClick()}}},[t._v(t._s(t.spotData.id||"\u83B7\u53D6\u8D26\u6237ID"))]),e("el-button",{attrs:{type:"primary"},on:{click:function(a){return t.testClick2()}}},[t._v("\u6D4B\u8BD52")]),e("el-button",{attrs:{type:"danger"},on:{click:function(a){t.$store.state.klineData=[]}}},[t._v("\u5220\u9664\u7F51\u7EDC\u6570\u636E")])],1),e("div",{staticClass:"data"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[e("el-table-column",{attrs:{prop:"currency",label:"currency",width:"80"}}),e("el-table-column",{attrs:{prop:"period",label:"period",width:"80"}}),e("el-table-column",{attrs:{prop:"price",label:"price",width:"80"}}),e("el-table-column",{attrs:{prop:"start",label:"start",width:"165"}}),e("el-table-column",{attrs:{prop:"end",label:"end",width:"165"}}),e("el-table-column",{attrs:{prop:"time",label:"time",width:"165"}}),e("el-table-column",{attrs:{prop:"length",label:"length"}}),e("el-table-column",{attrs:{fixed:"right",label:"\u64CD\u4F5C",width:"80"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(o){return t.$store.state.klineData.splice(a.$index,1)}}},[t._v("\u5220\u9664")])]}}])})],1)],1),e("el-divider"),e("div",{staticClass:"inputArea"},[e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u9ED8\u8BA4U\u989D")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.assetsAll,callback:function(a){t.$set(t.config,"assetsAll",a)},expression:"config.assetsAll"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u6BCF\u7B14\u4EA4\u6613\u989D")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.assetsSplit,callback:function(a){t.$set(t.config,"assetsSplit",a)},expression:"config.assetsSplit"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u5E73\u8861\u503C")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.assetsScale,callback:function(a){t.$set(t.config,"assetsScale",a)},expression:"config.assetsScale"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u4EA4\u6613\u6761\u4EF6")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.riseKey,callback:function(a){t.$set(t.config,"riseKey",a)},expression:"config.riseKey"}})],1),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("\u71C3\u6599\u8D39")]),e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.config.gas,callback:function(a){t.$set(t.config,"gas",a)},expression:"config.gas"}})],1)]),e("div",{staticClass:"buttons"},[e("el-button",{attrs:{type:"primary",loading:t.loading2},on:{click:function(a){return t.calculateDouble(t.klineData)}}},[t._v("\u8BA1\u7B97")]),e("el-button",{attrs:{type:"primary"},on:{click:function(a){return t.testClick(t.klineData)}}},[t._v("\u6D4B\u8BD5\u70B9\u51FB")]),e("el-button",{attrs:{type:"danger"},on:{click:function(a){t.$store.state.ccData=[]}}},[t._v("\u5220\u9664\u8BA1\u7B97\u6570\u636E")])],1),e("div",{staticClass:"data"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading2,expression:"loading2"}],staticStyle:{width:"100%"},attrs:{data:t.ccData,border:""}},[e("el-table-column",{attrs:{prop:"time",label:"time",width:"165"}}),e("el-table-column",{attrs:{prop:"currency",label:"currency",width:"100"}}),e("el-table-column",{attrs:{prop:"period",label:"period"}}),e("el-table-column",{attrs:{prop:"assetsAll",label:"\u672C\u91D1"}}),e("el-table-column",{attrs:{prop:"change",label:"change",sortable:""}}),e("el-table-column",{attrs:{prop:"rate",label:"rate",sortable:""}}),e("el-table-column",{attrs:{prop:"assetsSplit",label:"assetsSplit"}}),e("el-table-column",{attrs:{prop:"assetsScale",label:"assetsScale"}}),e("el-table-column",{attrs:{prop:"riseKey",label:"riseKey"}}),e("el-table-column",{attrs:{prop:"assets",label:"assets"}}),e("el-table-column",{attrs:{prop:"assets0",label:"assets0"}}),e("el-table-column",{attrs:{prop:"assets1",label:"assets1"}}),e("el-table-column",{attrs:{prop:"assetsNum0",label:"assetsNum0"}}),e("el-table-column",{attrs:{prop:"assetsNum1",label:"assetsNum1"}}),e("el-table-column",{attrs:{prop:"length",label:"length"}}),e("el-table-column",{attrs:{prop:"buyCount",label:"buyCount"}}),e("el-table-column",{attrs:{prop:"sellCount",label:"sellCount"}}),e("el-table-column",{attrs:{prop:"buyError",label:"buyError"}}),e("el-table-column",{attrs:{prop:"sellError",label:"sellError"}}),e("el-table-column",{attrs:{prop:"gas",label:"gas"}}),e("el-table-column",{attrs:{fixed:"right",label:"\u64CD\u4F5C",width:"80"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(o){return t.$store.state.ccData.splice(a.$index,1)}}},[t._v("\u5220\u9664")])]}}])})],1)],1),e("el-divider")],1)},M=[];var z=window.axios;const A={name:"Home",components:{HelloWorld:D},data(){return{input:"",loading:!1,loading2:!1}},computed:b(f({},F({config:l=>l.config,urls:l=>l.urls,klineData:l=>l.klineData,calculateData:l=>l.calculateData,ccData:l=>l.ccData,spotData:l=>l.accounts.filter(t=>t.type=="spot")[0]||{}})),{currencys(){return this.config.currencys.split(",")},periods(){return this.config.period.split(",")},tableData(){return this.klineData.map(l=>({currency:l.currency,period:l.period,price:l.price,length:l.list.length,start:d(l.list[0].id*1e3),end:d(l.list[l.list.length-1].id*1e3),time:d()}))}}),created(){},methods:{testClick(l){if(l.length==2){let s=l[0].list,e=l[1].list;for(const a in s)if(s[a].id!=e[a].id){this.$message.error("\u6570\u636E\u5BF9\u65F6\u95F4\u5F02\u5E38"+a);return}this.loading2=!0;let r=[this.config.assetsAll,this.config.assetsSplit,this.config.assetsScale,this.config.riseKey,this.config.gas].map(a=>{let i=[],o=String(a).split("-");if(o.length>1){let n=o[1].split("."),c=1;n.length>1&&(c=Math.pow(10,-n[1].length));let u=parseFloat(o[0]),p=u;for(i.push(u);parseFloat(i[i.length-1])<parseFloat(o[1]);)p=_(i[i.length-1]+c,c==1?0:n[1].length),i.push(p)}else i=o;return i});var t=new Worker("./work.js");t.postMessage({data:r,klineData:l}),t.onmessage=a=>{this.loading2=!1;let i=a.data;m("\u8BA1\u7B97\u5B8C\u6210",i.length),this.$store.state.ccData=i,t.terminate()}}else this.$message.error("\u8BF7\u9009\u62E9\u4E00\u5BF9\u6570\u636E")},testClick2(){function l(s){for(var e="",r=0;r<s.length;r++)e+=String.fromCharCode(s[r]);return e}var t=new WebSocket("wss://api.huobi.pro/ws");t.onopen=function(s){console.log("Connection open ..."),t.send("\u53D1\u9001\u7684\u6570\u636E"),t.send(JSON.stringify({req:"market.ethusdt.kline.1min",id:"id10",to:1621307580,from:1621307080}))},t.onmessage=function(s){var e=new FileReader;e.onload=function(r){var a=e.result;const o=require("pako").inflate(a);let n=l(o),c=JSON.parse(n);if(console.log(c),c.ping){let u=JSON.stringify({pong:c.ping});t.send(u)}},e.readAsArrayBuffer(s.data)},t.onclose=function(s){console.log("Connection closed.")}},handleClick(l,t){t==1?this.$store.state.calculateData=[...this.calculate1([this.klineData[l.$index]]),...this.$store.state.calculateData]:t==2&&this.$store.state.calculateData.splice(l.$index,1,this.calculate1([this.calculateData[l.$index].item])[0])},getData(){let l=this.currencys,t=this.periods,s=[],e=[];l.forEach(r=>{t.forEach(a=>{s.push(j(r,a,this.config,this.urls.klineUrl)),e.push({currency:r,period:a,list:[],price:0})})}),console.log(l),console.log(t),this.loading=!0,Promise.all(s).then(r=>{this.loading=!1,r.forEach((a,i)=>{e[i].list=[...a].reverse(),e[i].price=e[i].list[0].close}),this.$store.state.klineData=[...e,...this.$store.state.klineData]}).catch(r=>{console.log(r)})},async calculateDouble(l){if(l.length==2){let t=l[0].list,s=l[1].list;for(const i in t)if(t[i].id!=s[i].id){this.$message.error("\u6570\u636E\u5BF9\u65F6\u95F4\u5F02\u5E38"+i);return}this.loading2=!0;let e=[this.config.assetsAll,this.config.assetsSplit,this.config.assetsScale,this.config.riseKey,this.config.gas].map(i=>{let o=[],n=String(i).split("-");if(n.length>1){let c=n[1].split("."),u=1;c.length>1&&(u=Math.pow(10,-c[1].length));let p=parseFloat(n[0]),h=p;for(o.push(p);parseFloat(o[o.length-1])<parseFloat(n[1]);)h=_(o[o.length-1]+u,u==1?0:c[1].length),o.push(h)}else o=n;return o}),r=[];e[0].forEach(i=>{e[1].forEach(o=>{e[2].forEach(n=>{e[3].forEach(c=>{e[4].forEach(u=>{r.push([i,o,n,c,u])})})})})});let a=[];r.forEach(i=>{a.push(this.calculateDouble2(l,i[0],i[1],i[2],i[3],i[4]))}),m("\u8BA1\u7B97\u5B8C\u6210",a.length),this.loading2=!1,this.$store.state.ccData=a}else this.$message.error("\u8BF7\u9009\u62E9\u4E00\u5BF9\u6570\u636E")},calculateDouble2(l,t=100,s=5,e=1.2,r=.005,a=.002){s=parseFloat(s),e=parseFloat(e),r=parseFloat(r),a=parseFloat(a);let i={buyCount:0,sellCount:0,buyError:0,sellError:0,assets:parseFloat(t),assetsNum0:t/l[0].list[0].close,assetsNum1:t/l[1].list[0].close};l[0].list.forEach((n,c)=>{let u=l[0].list[c],p=l[1].list[c];this.calculateDouble3(u,"assetsNum0",i,t,s,e,r,a),this.calculateDouble3(p,"assetsNum1",i,t,s,e,r,a)});let o=b(f({currency:l[0].currency+","+l[1].currency,period:l[0].period,length:l[0].list.length,assets0:g(i.assetsNum0*l[0].list[l[0].list.length-1].close,2),assets1:g(i.assetsNum1*l[1].list[l[1].list.length-1].close,2),assetsAll:t,assetsSplit:s,assetsScale:e,riseKey:r,gas:a},i),{time:d(),assets:g(i.assets,2)});return o.change=g(o.assets+o.assets0+o.assets1-3*t,2),o.rate=o.change/(parseFloat(t)*3),o},calculateDouble3(l,t,s,e,r,a,i,o){let n=r*a,c=s[t]*l.close,u=(l.close-l.open)/l.open;if(Math.abs(u)>parseFloat(i))if(u>0){let p=c>s.assets?n:r,h=parseFloat(p)/l.close;s[t]>h?(s.assets+=parseFloat(p)*(1-parseFloat(o)),s[t]-=parseFloat(p)/l.close,s.sellCount++):s.sellError++}else{let p=c>s.assets?r:n;s.assets>p?(s.assets-=p,s[t]+=p/l.close*(1-parseFloat(o)),s.buyCount++):s.buyError++}}}};function j(l,t,s,e){let r=s.size,a={symbol:(l+"usdt").toLowerCase(),period:t,size:r};return new Promise((i,o)=>{z({method:"get",url:e,params:a}).then(n=>{let c=n.data.data;i(c)}).catch(n=>{m("\u9519\u8BEF:GetRecords",n),i([])})})}function d(l){return window.dayjs(l).format("YYYY-MM-DD HH:mm:ss")}function g(l,t=0){return Math.floor(l*Math.pow(10,t))/Math.pow(10,t)}function _(l,t=0){return Math.round(l*Math.pow(10,t))/Math.pow(10,t)}function m(){console.log(d(),...arguments)}const C={};var H=E(A,N,M,!1,R,null,null,null);function R(l){for(let t in C)this[t]=C[t]}var U=function(){return H.exports}();export{U as default};
