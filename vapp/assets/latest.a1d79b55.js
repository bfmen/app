import{c as n}from"./config.b0b2fcdf.js";import h from"./list.dc02e3f3.js";import p from"./tagSelect.c8369e8f.js";import{n as v,a as f}from"./index.432c51b4.js";import{z as g}from"./zip.23b2e55c.js";import{D as _}from"./index.23b46475.js";import"./pako.esm.f80f5d13.js";var m=function(){var e=this,a=e.$createElement,i=e._self._c||a;return e.isLoad?i("div",{staticClass:"hot"},[i("van-dropdown-menu",[i("van-dropdown-item",{attrs:{options:e.option1},on:{change:e.search},model:{value:e.value1,callback:function(t){e.value1=t},expression:"value1"}}),i("van-dropdown-item",{attrs:{options:e.option2},on:{change:e.search},model:{value:e.value0,callback:function(t){e.value0=t},expression:"value0"}})],1),i("van-search",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u641C\u7D22\u5173\u952E\u8BCD"},on:{search:e.search},model:{value:e.inputText,callback:function(t){e.inputText=t},expression:"inputText"}}),i("list",{attrs:{dataList:e.list,showKey:e.value1}}),i("infinite-loading",{ref:"infiniteLoading",attrs:{identifier:e.infiniteId},on:{infinite:e.infinite}},[i("div",{attrs:{slot:"spinner"},slot:"spinner"},[e._v("Loading...")]),i("div",{attrs:{slot:"no-more"},slot:"no-more"},[e._v("No more message")]),i("div",{attrs:{slot:"no-results"},slot:"no-results"},[e._v("No results message")])])],1):e._e()},w=[];const{zip:I,unzip:r}=g,s="b_dataSource",y={name:"keepAlive",components:{list:h,tagSelect:p},data(){return{isLoading:!1,current:1,vodid:"",dataSource:null,page:0,pageSize:20,list:[],timer:null,isLoad:!1,inputText:"",infiniteId:+new Date,db:null,value1:"vodid",value0:0,option2:[{text:"\u5012\u5E8F",value:0},{text:"\u6B63\u5E8F",value:1}]}},async created(){let e=weui.loading("loading");setTimeout(async()=>{try{let a=await x();window[s]=JSON.parse(r(a.data)),this.isLoad=!0,e.hide()}catch{e.hide(),setTimeout(()=>{this.loadAllData()},500)}})},computed:{option1(){let e=["vodid","createtime","updatetime","definition","commentcount","downcount_total","downnum","duration","scorenum","view_price","yearname","yearid"];return this.list.length&&Object.keys(this.list[0]).forEach(a=>{e.includes(a)||e.push(a)}),e.map(a=>({text:a,value:a}))}},watch:{page(){clearTimeout(this.timer),this.timer=setTimeout(()=>{console.log("load",this.page,this.value1,this.value0),this.list=this.getPageList(),this.page==1&&this.list.length&&(this.infiniteId=+new Date)},100)}},methods:{search(){console.log("search",this.inputText),this.inputText=="update"?weui.confirm("\u662F\u5426\u66F4\u65B0\u6E90\u6570\u636E",()=>{console.log("yes"),this.page=1,this.isLoading=!1,this.loadAllData(!0).then(()=>{this.infiniteId=+new Date,this.inputText=""})},()=>{console.log("no"),this.page=0,setTimeout(()=>{this.page=1},50)}):(this.page=0,setTimeout(()=>{this.page=1},50))},getPageList(){let e=window.b_dataSource;if(typeof e!="object")return[];let i=Object.keys(e).map(t=>e[t]).filter(t=>(t.coverpic=`${n.b_dataSource_url}/coverpic/${t.vodid}`,t.retcode_v=t.play_url_data?t.play_url_data.retcode:"99",this.inputText?(["vodid"].includes(this.value1)?[t.title,t[this.value1]]:[t[this.value1]]).some(o=>(o+"").toLowerCase().includes(this.inputText.toLowerCase())):!0)).sort((t,o)=>parseFloat(t[this.value1])==t[this.value1]&&parseFloat(o[this.value1])==o[this.value1]?this.value0==0?o[this.value1]-t[this.value1]:t[this.value1]-o[this.value1]:this.value0==0?o[this.value1].localeCompare(t[this.value1]):t[this.value1].localeCompare(o[this.value1])).slice(0,this.page*this.pageSize);return i.forEach(t=>{t.url=t.play_url_data?t.play_url_data.data.httpurl||t.play_url_data.data.httpurl_preview||t.play_url_data.retcode:""}),console.log("keys",i.map(t=>t[this.value1]).slice(0,this.pageSize)),i},async loadAllData(e){let a=weui.loading("downloading"),i=await f({url:["localhost","192.168"].some(o=>location.host.includes(o))&&!e?"./dataSource.txt":`${n.b_dataSource_url}/dataSource.txt`,onDownloadProgress:function(o){let l=b(o.loaded,2);console.log("progressEvent",l),a.querySelector(".weui-toast__content").innerText=l,o.lengthComputable;{let c=o.loaded/o.total*100;console.log("downLoadProgress",o.loaded,o.total,c)}}});await S(i.data);let t=JSON.parse(r(i.data));return window[s]=t,this.isLoad=!0,a.hide(),i},onRefresh(){this.page=1,this.isLoading=!1,setTimeout(()=>{this.infiniteId=+new Date})},infinite(e){this.page++;let a=this.list.length;setTimeout(()=>{a==this.list.length?(e.complete(),this.$toast("\u52A0\u8F7D\u5B8C\u6210")):e.loaded()},1e3)}}};function x(){var e=d();return e.get(s,s)}function S(e){var a=d();return a.put(s,{id:s,data:e})}function d(){var e=new _(s,1,{onupgradeneeded:a=>{console.log("onupgradeneeded");let i=a.target.result,t=s;i.objectStoreNames.contains(t)||i.createObjectStore(t,{keyPath:"id"})},onversionchange:a=>{}});return e}function b(e,a,i){var t;for(i=i||["B","K","M","G","TB"];(t=i.shift())&&e>1024;)e=e/1024;return(t==="B"?e:e.toFixed(a===void 0?2:a))+t}const u={};var T=v(y,m,w,!1,L,"42e3d851",null,null);function L(e){for(let a in u)this[a]=u[a]}var O=function(){return T.exports}();export{O as default};
