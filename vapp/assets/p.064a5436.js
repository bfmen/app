import{c as n}from"./config.73be10ef.js";import c from"./list.51bf3849.js";import h from"./tagSelect.ff8eb032.js";import{n as p,a as v}from"./index.901f2130.js";import{D as g,z as f}from"./index.cd7c9e45.js";var _=function(){var e=this,a=e.$createElement,i=e._self._c||a;return e.isLoad?i("div",{staticClass:"hot"},[i("van-dropdown-menu",[i("van-dropdown-item",{attrs:{options:e.option1},on:{change:e.search},model:{value:e.value1,callback:function(t){e.value1=t},expression:"value1"}}),i("van-dropdown-item",{attrs:{options:e.option2},on:{change:e.search},model:{value:e.value0,callback:function(t){e.value0=t},expression:"value0"}})],1),i("van-search",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u641C\u7D22\u5173\u952E\u8BCD"},on:{search:e.search},model:{value:e.inputText,callback:function(t){e.inputText=t},expression:"inputText"}}),e._l(e.list,function(t,o){return i("div",{key:o},[e._v(e._s(o))])}),i("infinite-loading",{ref:"infiniteLoading",attrs:{identifier:e.infiniteId},on:{infinite:e.infinite}},[i("div",{attrs:{slot:"spinner"},slot:"spinner"},[e._v("Loading...")]),i("div",{attrs:{slot:"no-more"},slot:"no-more"},[e._v("No more message")]),i("div",{attrs:{slot:"no-results"},slot:"no-results"},[e._v("No results message")])])],2):e._e()},m=[];const{zip:N,unzip:l}=f,s="p_dataSource",w={name:"keepAlive",components:{list:c,tagSelect:h},data(){return{isLoading:!1,current:1,vodid:"",dataSource:null,page:0,pageSize:20,list:[],timer:null,isLoad:!1,inputText:"",infiniteId:+new Date,db:null,value1:"vodid",value0:0,option2:[{text:"\u5012\u5E8F",value:0},{text:"\u6B63\u5E8F",value:1}]}},async created(){let e=weui.loading("loading");setTimeout(async()=>{try{let a=await x();window[s]=a.data,this.isLoad=!0,e.hide()}catch{e.hide(),setTimeout(()=>{this.loadAllData()},500)}})},computed:{option1(){let e=["vodid","createtime","updatetime","definition","commentcount","downcount_total","downnum","duration","scorenum","view_price","yearname","yearid"];return this.list.length&&Object.keys(this.list[0]).forEach(a=>{e.includes(a)||e.push(a)}),e.map(a=>({text:a,value:a}))}},watch:{page(){clearTimeout(this.timer),this.timer=setTimeout(()=>{console.log("load",this.page,this.value1,this.value0),this.list=this.getPageList(),this.page==1&&this.list.length&&(this.infiniteId=+new Date)},100)}},methods:{search(){console.log("search",this.inputText),this.inputText=="update"?weui.confirm("\u662F\u5426\u66F4\u65B0\u6E90\u6570\u636E",()=>{console.log("yes"),this.page=1,this.isLoading=!1,this.loadAllData(!0).then(()=>{this.infiniteId=+new Date,this.inputText=""})},()=>{console.log("no"),this.page=0,setTimeout(()=>{this.page=1},50)}):(this.page=0,setTimeout(()=>{this.page=1},50))},getPageList(){let e=JSON.parse(l(window[s]));if(typeof e!="object")return[];let i=Object.keys(e).map(t=>({...e[t],[this.value1]:t})).filter(t=>(t.coverpic=`${n.p_dataSource_url}/pornstars/img/${t[this.value1]}.jpg`,t.retcode_v=1,this.inputText?(["vodid"].includes(this.value1)?[t.title,t[this.value1]]:[t[this.value1]]).some(o=>(o+"").toLowerCase().includes(this.inputText.toLowerCase())):!0)).sort((t,o)=>parseFloat(t[this.value1])==t[this.value1]&&parseFloat(o[this.value1])==o[this.value1]?this.value0==0?o[this.value1]-t[this.value1]:t[this.value1]-o[this.value1]:this.value0==0?o[this.value1].localeCompare(t[this.value1]):t[this.value1].localeCompare(o[this.value1])).slice(0,this.page*this.pageSize);i.forEach(t=>{t.url=t.play_url_data?t.play_url_data.data.httpurl||t.play_url_data.data.httpurl_preview||t.play_url_data.retcode:""}),console.log("keys",i.map(t=>t[this.value1]).slice(0,this.pageSize));debugger;return i},async loadAllData(e){let a=weui.loading("downloading"),i=await v({url:`${n.p_dataSource_url}/pornstars/list.txt`,onDownloadProgress:function(t){let o=S(t.loaded,2);console.log("progressEvent",o),a.querySelector(".weui-toast__content").innerText=o,t.lengthComputable;{let d=t.loaded/t.total*100;console.log("downLoadProgress",t.loaded,t.total,d)}}});return await y(i.data),JSON.parse(l(i.data)),window[s]=i.data,this.isLoad=!0,a.hide(),i},onRefresh(){this.page=1,this.isLoading=!1,setTimeout(()=>{this.infiniteId=+new Date})},infinite(e){this.page++;let a=this.list.length;setTimeout(()=>{a==this.list.length?(e.complete(),this.$toast("\u52A0\u8F7D\u5B8C\u6210")):e.loaded()},1e3)}}};function x(){var e=u();return e.get(s,s)}function y(e){var a=u();return a.put(s,{id:s,data:e})}function u(){var e=new g(s,1,{onupgradeneeded:a=>{console.log("onupgradeneeded");let i=a.target.result,t=s;i.objectStoreNames.contains(t)||i.createObjectStore(t,{keyPath:"id"})},onversionchange:a=>{}});return e}function S(e,a,i){var t;for(i=i||["B","K","M","G","TB"];(t=i.shift())&&e>1024;)e=e/1024;return(t==="B"?e:e.toFixed(a===void 0?2:a))+t}const r={};var T=p(w,_,m,!1,b,"226550b7",null,null);function b(e){for(let a in r)this[a]=r[a]}var P=function(){return T.exports}();export{P as default};
