var d=Object.defineProperty;var c=(t,a,s)=>a in t?d(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s;var n=(t,a,s)=>(c(t,typeof a!="symbol"?a+"":a,s),s);import{c as r}from"./config.5c06e1b3.js";import{a as h,n as u}from"./index.820fe94a.js";class p{constructor(a,s,e){n(this,"url","https://api2.bmob.cn");n(this,"fetch",async function(a="",s={}){return(await window.fetch(a,{...s,headers:{"Content-Type":"application/json","X-Bmob-Application-Id":this.id,"X-Bmob-REST-API-Key":this.key,...s.headers}})).json()});this.id=a,this.key=s,this.masterKey=e}classes(a){const s=this;return{get(e={}){return s.fetch(`${s.url}/1/classes/${a}?where=${JSON.stringify(e)}`,{method:"GET"})},add(e){return s.fetch(`${s.url}/1/classes/${a}`,{method:"POST",body:JSON.stringify(e)})},put(e,i){return s.fetch(`${s.url}/1/classes/${a}/${e}`,{method:"PUT",body:JSON.stringify(i)})},delete(e){return s.fetch(`${s.url}/1/classes/${a}/${e}`,{method:"DELETE"})}}}request(a){return h({...a,headers:{"Content-Type":"application/json","X-Bmob-Application-Id":this.id,"X-Bmob-REST-API-Key":this.key,...a.headers}}).then(s=>s.data)}}var _=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"list"},[t.title?s("div",{staticClass:"header",on:{click:t.headerClick}},[s("span",{staticClass:"title"},[t._v(t._s(t.title))]),s("span",{staticClass:"more"},[t._v("\u66F4\u591A")])]):t._e(),s("div",{staticClass:"numInfo"},[t._v(" "+t._s(this.dataList.filter(function(e){return e.play_url_data?[".m3u8",".mp4"].some(function(i){return JSON.stringify(e.play_url_data).includes(i)}):e.isvip!=1}).length)+"/"+t._s(t.dataList.length)+" ")]),s("div",{staticClass:"items"},t._l(t.list,function(e,i){return s("div",{key:i+e.vodid,staticClass:"item",class:{itemMin:t.isMin},on:{click:function(o){return t.itemClick(e)}}},[t.vodid==e.vodid&&t.videoUrl?s("video",{ref:"video"+e.vodid,refInFor:!0,staticClass:"video bananaListVideo",class:{videoMin:t.isMin},attrs:{controls:"controls",playsinline:"",autoplay:"",title:e.title,poster:e.coverpic,"picture-in-picture-mode":["push","pop"],src:t.videoUrl}}):s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.coverpic,expression:"item.coverpic"}],staticClass:"image",class:{imagemMin:t.isMin},attrs:{mode:"aspectFit"},on:{load:function(o){return t.loadImage(e,o)}}}),s("span",{on:{click:function(o){o.stopPropagation(),t.isShow=!0,t.currentItem=e}}},[t._v(t._s(e.title||e.catename)+" "+t._s(t.showVideoState(e)))]),s("div",{staticClass:"tips"},[e.isvip==1||e.play_url_data&&e.play_url_data.errmsg&&e.play_url_data.retcode!=5?s("span",{staticClass:"isvip"},[t._v(t._s(e.play_url_data&&e.play_url_data.errmsg&&e.play_url_data.retcode!=3?e.play_url_data.errmsg:e.isvip==1?"vip":""))]):t._e(),e.definition>0&&!t.showKey?s("span",{staticClass:"definition"},[t._v(t._s(e.definition))]):t._e(),!t.isMin&&!t.showKey?s("span",{staticClass:"updatetime"},[t._v(t._s(e.updatetime))]):t._e(),t.showKey?t._e():s("span",{staticClass:"upnum"},[t._v(t._s(e.upnum))]),t.showKey?t._e():s("span",{staticClass:"scorenum"},[t._v(t._s(e.scorenum))]),t.showKey?t._e():s("span",{staticClass:"duration"},[t._v(t._s(e.duration))]),t.showKey&&e.retcode_v==3?s("span",{staticClass:"duration"},[t._v(t._s("\u9884\u89C8"))]):t._e(),t.showKey?s("span",{staticClass:"duration"},[t._v(t._s(e[t.showKey]))]):t._e()])])}),0),s("van-action-sheet",{attrs:{actions:t.actions,"cancel-text":"\u53D6\u6D88"},on:{select:t.onSelect},model:{value:t.isShow,callback:function(e){t.isShow=e},expression:"isShow"}})],1)},v=[];const f=new p(r.bananaBomb.id,r.bananaBomb.key),g=f.classes("Like"),y={props:{dataList:{default:()=>[]},info:{default:()=>({})},title:{default:""},isMin:{default:!1},showKey:{default:""}},data(){return{vodid:"",videoUrl:"",loading:"",isLoading:!1,isShow:!1,actions:[{name:"\u6536\u85CF"},{name:"\u590D\u5236"},{name:"\u6536\u85CF"}],currentItem:{}}},computed:{list(){return this.dataList.filter(t=>this.$store.state.banana.isVipShow||(t.play_url_data?[".m3u8",".mp4"].some(a=>JSON.stringify(t.play_url_data).includes(a)):t.isvip!=1)).map(t=>(console.log("change"),this.$store.state.banana.checkedChange?{...t,title:"title",coverpic:"https://demo.internal.cloudpivot.cn/favicon.ico"}:t))}},watch:{dataList(t){this.updateItem()}},methods:{updateItem(){this.dataList.forEach(t=>{t.url=this.gerBVInfo()[t.vodid]||t.url||"",t.intro=t.url})},headerClick(){this.info.spid?this.$router.push({path:"./detail?spid="+this.info.spid}):this.$router.push({path:"./class"})},showVideoState(t){let a=t.intro||t.url;return a?a===5?"vip":a.startsWith&&a.startsWith("http")?"ok":"..":".."},loadImage(t,a){let s=a.target||a.path[0];s.src&&s.src.startsWith("http")&&this.itemClick(t,!0)},setBVInfo(t,a){let s=a.data.data.httpurl||a.data.data.httpurl_preview||a.data.retcode,e={};try{e=JSON.parse(localStorage.BVInfo)}catch{}e[t.vodid]=s,t.url=s,t.intro=s,localStorage.BVInfo=JSON.stringify(e),this.updateItem()},gerBVInfo(){try{return JSON.parse(localStorage.BVInfo)}catch{return{}}},itemClick(t,a){let s=t.url;if(s&&String(s).startsWith("http")){a||(this.videoUrl=s,this.vodid=t.vodid,this.hideOtherVideo(),document&&(document.title=t.title));return}else if(s){a||this.$toast(t.play_url_data?t.play_url_data.errmsg:s);return}a||(this.loading&&this.loading.hide(),this.loading=weui.loading()),t.vodid!=this.vodid&&(this.isLoading=!0,this.$axios({url:r.origin+t.play_url,params:r.query()}).then(e=>{this.isLoading=!1,this.setBVInfo(t,e),a||(this.loading&&this.loading.hide(),console.log("success",e),e.data.data.httpurl?(this.videoUrl=e.data.data.httpurl,this.vodid=t.vodid,this.hideOtherVideo()):e.data.data.httpurl_preview?(this.videoUrl=e.data.data.httpurl_preview,this.vodid=t.vodid,this.hideOtherVideo()):this.$toast(e.data.errmsg||"fail"),document&&(document.title=t.title))}).catch(e=>{a||(this.loading&&this.loading.hide(),this.$toast(e.message||"fail"))}))},hideOtherVideo(){setTimeout(()=>{this.$refs["video"+this.vodid][0].play();let t=new Array(...document.querySelectorAll(".bananaListVideo")).filter(a=>a.src!=this.videoUrl).forEach(a=>{a.pause(),a.parentElement.parentElement.parentElement.__vue__.vodid="",a.parentElement.parentElement.parentElement.__vue__.videoUrl=""});console.log(t)})},async onSelect(t){if(t.name="\u6536\u85CF"){let a=weui.loading(),s=await g.add({title:this.currentItem.title,url:this.currentItem.url||this.videoUrl,coverpic:this.currentItem.coverpic});s.objectId?this.$toast("\u6536\u85CF\u6210\u529F"):this.$toast(s.error||"fail"),this.isShow=!1,a.hide()}else(t.name="\u590D\u5236")&&(this.videoUrl&&m(this.videoUrl),this.$toast("\u590D\u5236\u6210\u529F"))}},destroyed(){this.loading&&this.loading.hide()},deactivated(){console.log("deactivated"),this.loading&&this.loading.hide()}};function m(t){var a=document.createElement("input");a.value=t,document.body.appendChild(a),a.select(),document.execCommand("Copy"),a.remove(),console.log("copy")}const l={};var w=u(y,_,v,!1,C,"777d857c",null,null);function C(t){for(let a in l)this[a]=l[a]}var b=function(){return w.exports}();export{b as default};
