import{c as r}from"./config.959b753b.js";import{n}from"./index.4a606743.js";var l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"scroll",staticClass:"scroll",on:{scroll:t.scroll,touchend:t.touchend}},[i("video",{ref:"video",staticClass:"video",attrs:{controls:"controls",playsinline:"",autoplay:"",src:t.currentItem&&t.currentItem.videoUrl,poster:t.currentItem&&t.currentItem.vodrow.coverpic}}),t._l(t.rows,function(o,s){return i("div",{key:s,ref:"index"+s,refInFor:!0,staticClass:"swiperItem",on:{click:function(v){return t.clickHandler(o,s)}}},[Math.abs(s-t.current)<3?i("div",{staticClass:"itemContent"},[i("div",{ref:"content"+s,refInFor:!0,staticClass:"content"},[i("img",{style:t.current==s?"filter: blur(20px);":"",attrs:{src:o.vodrow.coverpic}})]),t.isShowMask?i("div",{staticClass:"mask",on:{click:t.tipClick}},[i("div",[t._v("@"+t._s(o.user.nickname))]),i("div",[t._v(t._s(o.vodrow.title))]),i("div",[t._v(t._s(o.vodrow.updatetime))])]):t._e()]):t._e()])})],2)},d=[];const c={data(){return{rows:[],current:0,isShowMask:!0,options:{scrollY:!0},isVideoLoading:!1,isMoreLoading:!1}},computed:{currentItem(){return this.rows.length>0?this.rows[this.current]:null}},created(){console.log("created banana"),this.loadData(!0)},mounted(){},methods:{scroll(t){let e=this.$refs.scroll.scrollTop,i=this.$refs.scroll.clientHeight,o=Math.round(e/i);this.changePage(o)},touchend(t){},loadData(t){this.isMoreLoading=!0,this.$axios.request({url:r.origin+"/minivod/reqlist",params:r.query()}).then(e=>{if(this.isMoreLoading=!1,console.log("success",e),e.status==200&&e.data.retcode==0){var i=[];e.data.data.rows.map(o=>{o.vodrow&&o.vodrow.vodid&&(o.videoUrl="",i.push(o))}),t?(this.rows=i,this.changePage(0)):this.rows.push(i[0])}else weui.topTips(e.data.errmsg||e.statusCode||"fail")}).catch(e=>{this.isMoreLoading=!1,weui.topTips(e.message||"fail")})},clickHandler(t,e){this.isShowMask=!this.isShowMask},tipClick(t){this.$refs.video.play(),this.isShowMask=!this.isShowMask,t.stopPropagation()},changePage(t){const e=this.rows[t],i=e.vodrow.vodid;document&&(document.title=e.vodrow.title),this.current=t,!e.videoUrl&&!this.isVideoLoading?(this.isVideoLoading=!0,this.$axios.request({url:r.origin+"/minivod/reqplay/"+i,params:r.query()}).then(o=>{this.isVideoLoading=!1,console.log("success",o);var s=o.data.data.httpurl||o.data.data.httpurl_preview;s?(console.log(s),this.rows[t].videoUrl=s,setTimeout(()=>{this.$refs["content"+this.current][0].appendChild(this.$refs.video),this.$refs.video.play()},20)):weui.topTips(o.data.errmsg||o.statusCode||"fail")}).catch(o=>{this.isVideoLoading=!1,weui.topTips(o.message||"fail")})):this.$refs["content"+this.current][0].querySelector(".video")||this.$refs["content"+this.current][0].appendChild(this.$refs.video),t==this.rows.length-1&&!this.isMoreLoading&&this.loadData()}},watch:{}},a={};var h=n(c,l,d,!1,u,"85001bd8",null,null);function u(t){for(let e in a)this[e]=a[e]}var m=function(){return h.exports}();export{m as default};
