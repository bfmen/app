import{c as r}from"./config.b0b2fcdf.js";import{n}from"./index.7ba49594.js";var l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"scroll",staticClass:"scroll",on:{scroll:t.scroll,touchend:t.touchend}},[i("video",{ref:"video",staticClass:"video",attrs:{controls:"controls",playsinline:"",autoplay:"",src:t.currentItem&&t.currentItem.videoUrl,poster:t.currentItem&&t.currentItem.vodrow.coverpic}}),t._l(t.rows,function(s,o){return i("div",{key:o,ref:"index"+o,refInFor:!0,staticClass:"swiperItem",on:{click:function(v){return t.clickHandler(s,o)}}},[Math.abs(o-t.current)<3?i("div",{staticClass:"itemContent"},[i("div",{ref:"content"+o,refInFor:!0,staticClass:"content"},[i("img",{style:t.current==o?"filter: blur(20px);":"",attrs:{src:s.vodrow.coverpic}})]),t.isShowMask?i("div",{staticClass:"mask",on:{click:t.tipClick}},[i("div",[t._v("@"+t._s(s.user.nickname))]),i("div",[t._v(t._s(s.vodrow.title))]),i("div",[t._v(t._s(s.vodrow.updatetime))])]):t._e()]):t._e()])})],2)},c=[];const d={data(){return{rows:[],current:0,isShowMask:!0,options:{scrollY:!0},isVideoLoading:!1,isMoreLoading:!1}},computed:{currentItem(){return this.rows.length>0?this.rows[this.current]:null}},created(){console.log("created banana"),this.loadData(!0)},mounted(){},methods:{scroll(t){let e=this.$refs.scroll.scrollTop,i=this.$refs.scroll.clientHeight,s=Math.round(e/i);this.changePage(s)},touchend(t){},loadData(t){this.isMoreLoading=!0,this.$axios.request({url:r.origin+"/minivod/reqlist",params:r.query()}).then(e=>{if(this.isMoreLoading=!1,console.log("success",e),e.status==200&&e.data.retcode==0){var i=[];e.data.data.rows.map(s=>{s.vodrow&&s.vodrow.vodid&&(s.videoUrl="",i.push(s))}),t?(this.rows=i,this.changePage(0)):this.rows.push(i[0])}else weui.topTips(e.data.errmsg||e.statusCode||"fail")}).catch(e=>{this.isMoreLoading=!1,weui.topTips(e.message||"fail")})},clickHandler(t,e){this.isShowMask=!this.isShowMask},tipClick(t){this.$refs.video.play(),this.isShowMask=!this.isShowMask,t.stopPropagation()},changePage(t){const e=this.rows[t],i=e.vodrow.vodid;document&&(document.title=e.vodrow.title),this.current=t,!e.videoUrl&&!this.isVideoLoading?(this.isVideoLoading=!0,this.$axios.request({url:r.origin+"/minivod/reqplay/"+i,params:r.query()}).then(s=>{this.isVideoLoading=!1,console.log("success",s);var o=s.data.data.httpurl||s.data.data.httpurl_preview;o?(console.log(o),this.rows[t].videoUrl=o,setTimeout(()=>{this.$refs["content"+this.current][0].appendChild(this.$refs.video),this.$refs.video.play()},20)):weui.topTips(s.data.errmsg||s.statusCode||"fail")}).catch(s=>{this.isVideoLoading=!1,weui.topTips(s.message||"fail")})):this.$refs["content"+this.current][0].querySelector(".video")||this.$refs["content"+this.current][0].appendChild(this.$refs.video),t==this.rows.length-1&&!this.isMoreLoading&&this.loadData()}},watch:{}},a={};var u=n(d,l,c,!1,h,"85001bd8",null,null);function h(t){for(let e in a)this[e]=a[e]}var _=function(){return u.exports}();export{_ as default};
