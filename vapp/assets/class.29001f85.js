import{c as o}from"./config.b0b2fcdf.js";import d from"./list.c07acb38.js";import n from"./tagSelect.33efca40.js";import{n as c}from"./index.3eb64a3d.js";var l=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"class"},[e._l(e.tags,function(a,s){return t("tagSelect",{key:s,ref:`tagSelect${s}`,refInFor:!0,attrs:{dataSource:a},on:{tagClick:function(h){return e.tagClick(s,arguments)}}})}),t("list",{attrs:{dataList:e.vodrows}}),e.dataSource.action?t("infinite-loading",{ref:"infiniteLoading",attrs:{identifier:e.identifier},on:{infinite:e.infinite}}):e._e()],2)},u=[];const f={components:{list:d,tagSelect:n},data(){return{page:0,identifier:0,vodrows:[],dataSource:{params:{},action:""},classList:[{key:"categories",query:"cateid",id:0},{key:"areas",query:"areaid",id:0},{key:"years",query:"yearid",id:0},{key:"definitions",query:"definition",id:0},{key:"durations",query:"duration",id:0},{key:"freetypes",query:"freetype",id:0},{key:"mosaics",query:"mosaic",id:0},{key:"langvoices",query:"langvoice",id:0},{key:"orders",query:"order",id:0}]}},computed:{tags(){let e=[];return this.classList.forEach(i=>{let t=this.dataSource[i.key];t&&e.push({items:[{id:0,title:"\u5168\u90E8"}].concat(t.map(a=>{let s=a.keyid||a.cateid||a.areaid||a.yearid;return{...a,id:s}})),id:i.id})}),e}},created(){this.loadBaseData()},methods:{tagClick(e,i){let t=0;i?t=i[0]:t=this.$refs["tagSelect"+e][0].idx,this.classList[e].id=this.tags[e].items[t].id},itemClick(e){e.spid&&uni.navigateTo({url:"./detail?spid="+e.spid})},infinite(e){console.log("onReachBottom"),this.loadPageData(this.page+1,e)},loadBaseData(){this.$axios.request({url:o.origin+"/vod/recommend",params:o.query()}).then(e=>{console.log("success",e),e.status==200&&e.data.retcode==0?this.dataSource=e.data.data:weui.topTips(e.data.errmsg||e.statusCode||"fail")}).catch(e=>{weui.topTips(e.message||"fail")})},loadPageData(e,i){this.$axios.request({url:o.origin+"/vod/listing-"+this.classList.map(t=>t.id).join("-")+"-"+this.page,params:o.query()}).then(t=>{console.log("success",t),t.status==200&&t.data.retcode==0?(this.page=e,this.page==1?this.vodrows=t.data.data.vodrows:this.vodrows=this.vodrows.concat(t.data.data.vodrows),t.data.data.vodrows.length<16?i&&i.complete():i&&i.loaded()):(weui.topTips(t.data.errmsg||t.statusCode||"fail"),i&&i.loaded())}).catch(t=>{i&&i.loaded(),weui.topTips(t.message||"fail")})}},watch:{classList:{deep:!0,handler(e){console.log("classList",e),this.page=0,this.vodrows=[],this.identifier=new Date().valueOf()}}}},r={};var p=c(f,l,u,!1,g,"2b8a5772",null,null);function g(e){for(let i in r)this[i]=r[i]}var k=function(){return p.exports}();export{k as default};
