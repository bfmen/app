import{_ as w,o as u,c as m,a as e,t as c,w as d,v as a,d as h,F as f,r as A,e as b,p as k,b as v}from"./index-BTwWhGwo.js";const y={mixins:[],data(){return{port:{},reader:{},isOpen:!1,dataR:"",dataW:"",timer:null,reader:{},writer:{},list:[],checked:[],imei:"",mac:"",mac2:"",ip:"192.168.0.1",lteCell:{isLock:!1,arfcn:"",cell:""}}},computed:{},created(){window.that=this,this.timer=setInterval(()=>{this.isOpen=!!this.port.readable},100)},methods:{async click(){if(!navigator.serial){alert("该浏览器不支持，仅支持基于chromium内核的pc浏览器");return}try{if(this.port.getInfo&&this.port.readable){try{this.reader.releaseLock(),this.writer.releaseLock()}catch{}await this.port.close(),this.reader={}}else{const l=await navigator.serial.requestPort();this.port=l,this.port.readable||(await l.open({dataBits:8,stopBits:1,parity:"none",baudRate:9600}),this.reader=this.port.readable.getReader(),this.writer=this.port.writable.getWriter(),this.write("AT+CGSN"),setTimeout(()=>{this.write("AT+MAC?")},500),setTimeout(()=>{this.write("AT+MAC2?")},1e3),setTimeout(()=>{this.getBand()},1500),setTimeout(()=>{this.write("AT+ZLC?")},200))}}catch(l){console.log("error",l),l.message&&!l.message.includes("No port selected by the user")&&alert(l.message)}},getBand(){this.write("AT+ZLTEAMTBAND?"),setTimeout(()=>{this.write("AT+ZLTEBAND?")},200)},async read(){const l=this.reader,{value:t,done:o}=await l.read();let s=T(t);console.log("接收",s),this.dataR+=s,this.dataHandler(s)},async write(l){const t=this.writer;let o=(l||this.dataW)+`\r
`,s=x(o);await t.write(s),setTimeout(()=>{this.read()},500)},dataHandler(l){let t="ZLTEAMTBAND: ";if(l.includes(t)&&l.includes(t)&&l.length>20&&(this.list=this.getSupportedBand(l.split(t)[1].split(`\r
`)[0])),t="+ZLTEBAND: ",l.includes(t)&&l.includes(t)&&l.length>20){let o=this.getLockedBand(l.split(t)[1].split(`\r
`)[0]);this.checked=o}if(t="+CGSN: ",l.includes(t)&&(this.imei=l.split(t)[1].split(`\r
`)[0]),t="+MAC:",l.includes(t)&&(this.mac=l.split(t)[1].split(`\r
`)[0]),t="+MAC2:",l.includes(t)&&(this.mac2=l.split(t)[1].split(`\r
`)[0]),t="+ZLC: ",l.includes(t)){let o=l.split(t)[1].split(`\r
`)[0].split(",");this.lteCell.isLock=o[0]==="1",this.lteCell.arfcn=o[1],this.lteCell.pci=o[2]}},getSupportedBand(l){return l.split(",").reduce((t,o,s)=>{let r=parseInt(o).toString(2);for(var n=0;n<r.length;n++)parseInt(r[r.length-n-1])&&t.push(s*8+n+1);return t},[])},getLockedBand(l){return this.getSupportedBand(l).filter(t=>this.list.includes(t))},submit(){let l=[];for(var t=0;t<8;t++){let s="";for(var o=0;o<8;o++)this.checked.includes(t*8+o+1)?s="1"+s:s="0"+s;l.push(parseInt(s,2))}this.write("AT+ZLTEBAND="+l.join(","))},async reboot(){window.open(`http://${this.ip}/goform/goform_set_cmd_process?goformId=REBOOT_DEVICE`)},reboot1869(){window.open(`http://${this.ip}/reqproc/proc_post?isTest=false&goformId=REBOOT_DEVICE`)},async openADB(){window.open(`http://${this.ip}/goform/goform_set_cmd_process?goformId=SET_DEVICE_MODE&debug_enable=1`)},async closeADB(){window.open(`http://${this.ip}/goform/goform_set_cmd_process?goformId=SET_DEVICE_MODE&debug_enable=0`)},async openADB2(){window.open(`http://${this.ip}/reqproc/proc_post?goformId=SET_DEVICE_MODE&debug_enable=1`)},async closeADB2(){window.open(`http://${this.ip}/reqproc/proc_post?goformId=SET_DEVICE_MODE&debug_enable=0`)}},async unmounted(){clearInterval(this.timer);try{this.reader.releaseLock(),this.writer.releaseLock(),await this.port.close(),this.reader={}}catch{}},watch:{dataR(){this.$nextTick(()=>{const l=document.getElementById("scroll_text");l.scrollTop=l.scrollHeight})}}};function T(l){for(var t="",o=0;o<l.length;o++)t+=String.fromCharCode(l[o]);return t}function x(l){for(var t=[],o=0;o<l.length;o++)t.push(l.charCodeAt(o));var s=new Uint8Array(t);return s}const p=l=>(k("data-v-ee6100bd"),l=l(),v(),l),B={class:"atMaster",style:{padding:"10px"}},E=p(()=>e("label",null,"ip: ",-1)),D={class:"content"},I={style:{padding:"10px 0"}},L={style:{padding:"10px 0"}},M=p(()=>e("label",null,"IMEI: ",-1)),S={style:{padding:"10px 0"}},_=p(()=>e("label",null,"无线MAC: ",-1)),V={style:{padding:"10px 0"}},O=p(()=>e("label",null,"有线MAC: ",-1)),U={style:{display:"flex","flex-wrap":"wrap","align-items":"center",padding:"10px 0"}},Z={for:"option1"},N=["value"],R=p(()=>e("br",null,null,-1)),W=p(()=>e("br",null,null,-1)),q={style:{padding:"10px 0"}},G=p(()=>e("label",null,"频点: ",-1)),H=p(()=>e("label",{style:{"margin-left":"20px"}},"小区: ",-1)),F=p(()=>e("label",{style:{"margin-left":"20px"}},"是否锁定: ",-1)),z=p(()=>e("div",null,[e("label",{style:{opacity:"0.5"}},"显示的仅为之前保存锁定小区的数据，并非是当前实际接入的小区")],-1)),P={class:"right"};function J(l,t,o,s,r,n){return u(),m("div",B,[e("button",{onClick:t[0]||(t[0]=(...i)=>n.click&&n.click(...i))},"选择端口 "+c(r.isOpen?"（已开启）":"（未开启）"),1),e("div",null,[E,d(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=i=>r.ip=i)},null,512),[[a,r.ip]]),e("button",{onClick:t[2]||(t[2]=(...i)=>n.openADB&&n.openADB(...i))},"开启adb "),e("button",{onClick:t[3]||(t[3]=(...i)=>n.closeADB&&n.closeADB(...i))},"关闭adb "),e("button",{onClick:t[4]||(t[4]=(...i)=>n.openADB2&&n.openADB2(...i))},"开启adb2 "),e("button",{onClick:t[5]||(t[5]=(...i)=>n.closeADB2&&n.closeADB2(...i))},"关闭adb2 "),e("button",{onClick:t[6]||(t[6]=(...i)=>n.reboot&&n.reboot(...i))},"重启"),e("button",{onClick:t[7]||(t[7]=(...i)=>n.reboot1869&&n.reboot1869(...i))},"重启2")]),d(e("div",D,[e("div",I,[e("button",{onClick:t[8]||(t[8]=i=>n.write("AT+ZMODE=1"))},"工厂模式"),e("button",{onClick:t[9]||(t[9]=i=>n.write("AT+ZMODE=0"))},"退出工厂模式")]),e("div",L,[M,d(e("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=i=>r.imei=i)},null,512),[[a,r.imei]]),e("button",{onClick:t[11]||(t[11]=i=>n.write("AT+CGSN"))},"读取"),e("button",{onClick:t[12]||(t[12]=i=>n.write("AT+MODIMEI="+r.imei))},"写入")]),e("div",S,[_,d(e("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=i=>r.mac=i)},null,512),[[a,r.mac]]),e("button",{onClick:t[14]||(t[14]=i=>n.write("AT+MAC?"))},"读取"),e("button",{onClick:t[15]||(t[15]=i=>n.write("AT+MAC="+r.mac))},"写入")]),e("div",V,[O,d(e("input",{type:"text","onUpdate:modelValue":t[16]||(t[16]=i=>r.mac2=i)},null,512),[[a,r.mac2]]),e("button",{onClick:t[17]||(t[17]=i=>n.write("AT+MAC2?"))},"读取"),e("button",{onClick:t[18]||(t[18]=i=>n.write("AT+MAC2="+r.imei))},"写入")]),e("div",U,[(u(!0),m(f,null,A(r.list,(i,g)=>(u(),m("span",{key:g,style:{display:"flex","flex-wrap":"wrap","align-items":"center",padding:"0 5px"}},[e("label",Z,"LTE B"+c(i),1),d(e("input",{type:"checkbox","onUpdate:modelValue":t[19]||(t[19]=C=>r.checked=C),value:i},null,8,N),[[b,r.checked,void 0,{number:!0}]]),R,W]))),128)),e("button",{onClick:t[20]||(t[20]=(...i)=>n.getBand&&n.getBand(...i))},"读取频段"),e("button",{onClick:t[21]||(t[21]=(...i)=>n.submit&&n.submit(...i))},"锁定频段")]),e("div",q,[G,d(e("input",{style:{width:"80px"},type:"text","onUpdate:modelValue":t[22]||(t[22]=i=>r.lteCell.arfcn=i)},null,512),[[a,r.lteCell.arfcn]]),H,d(e("input",{style:{width:"80px"},type:"text","onUpdate:modelValue":t[23]||(t[23]=i=>r.lteCell.pci=i)},null,512),[[a,r.lteCell.pci]]),F,d(e("input",{type:"checkbox","onUpdate:modelValue":t[24]||(t[24]=i=>r.lteCell.isLock=i),value:!0},null,512),[[b,r.lteCell.isLock,void 0,{number:!0}]]),e("button",{onClick:t[25]||(t[25]=i=>n.write("AT+ZLC?"))},"读取"),e("button",{onClick:t[26]||(t[26]=i=>n.write(`AT+ZLC=${r.lteCell.isLock?1:0},${r.lteCell.arfcn},${r.lteCell.pci}`))},"写入"),z]),e("div",null,[d(e("input",{type:"text","onUpdate:modelValue":t[27]||(t[27]=i=>r.dataW=i),placeholder:"发送自定义AT指令"},null,512),[[a,r.dataW]]),e("button",{onClick:t[28]||(t[28]=i=>n.write())},"发送")]),e("div",P,[d(e("textarea",{id:"scroll_text",cols:"30",rows:"10","onUpdate:modelValue":t[29]||(t[29]=i=>r.dataR=i),readonly:""},null,512),[[a,r.dataR]]),e("button",{onClick:t[30]||(t[30]=i=>r.dataR="")},"清理")])],512),[[h,r.isOpen]])])}const Q=w(y,[["render",J],["__scopeId","data-v-ee6100bd"]]);export{Q as default};
