import{_ as C,o as u,c as m,a as l,t as c,w as d,v as a,d as w,F as f,r as v,e as b,p as k,b as A}from"./index-BIWdyHS9.js";const y={mixins:[],data(){return{port:{},reader:{},isOpen:!1,dataR:"",dataW:"",timer:null,reader:{},writer:{},list:[],checked:[],imei:"",mac:"",mac2:"",ip:"192.168.0.1",lteCell:{isLock:!1,arfcn:"",cell:""}}},computed:{},created(){window.that=this,this.timer=setInterval(()=>{this.isOpen=!!this.port.readable},100)},methods:{async click(){if(!navigator.serial){alert("该浏览器不支持，仅支持基于chromium内核的pc浏览器");return}try{if(this.port.getInfo&&this.port.readable){try{this.reader.releaseLock(),this.writer.releaseLock()}catch{}await this.port.close(),this.reader={}}else{const e=await navigator.serial.requestPort();this.port=e,this.port.readable||(await e.open({dataBits:8,stopBits:1,parity:"none",baudRate:9600}),this.reader=this.port.readable.getReader(),this.writer=this.port.writable.getWriter(),this.write("AT+CGSN"),setTimeout(()=>{this.write("AT+MAC?")},500),setTimeout(()=>{this.write("AT+MAC2?")},1e3),setTimeout(()=>{this.getBand()},1500),setTimeout(()=>{this.write("AT+ZLC?")},200))}}catch(e){console.log("error",e),e.message&&!e.message.includes("No port selected by the user")&&alert(e.message)}},getBand(){this.write("AT+ZLTEAMTBAND?"),setTimeout(()=>{this.write("AT+ZLTEBAND?")},200)},async read(){const e=this.reader,{value:t,done:s}=await e.read();let o=T(t);console.log("接收",o),this.dataR+=o,this.dataHandler(o)},async write(e){const t=this.writer;let s=(e||this.dataW)+`\r
`,o=x(s);await t.write(o),setTimeout(()=>{this.read()},500)},dataHandler(e){let t="ZLTEAMTBAND: ";if(e.includes(t)&&e.includes(t)&&e.length>20&&(this.list=this.getSupportedBand(e.split(t)[1].split(`\r
`)[0])),t="+ZLTEBAND: ",e.includes(t)&&e.includes(t)&&e.length>20){let s=this.getLockedBand(e.split(t)[1].split(`\r
`)[0]);this.checked=s}if(t="+CGSN: ",e.includes(t)&&(this.imei=e.split(t)[1].split(`\r
`)[0]),t="+MAC:",e.includes(t)&&(this.mac=e.split(t)[1].split(`\r
`)[0]),t="+MAC2:",e.includes(t)&&(this.mac2=e.split(t)[1].split(`\r
`)[0]),t="+ZLC: ",e.includes(t)){let s=e.split(t)[1].split(`\r
`)[0].split(",");this.lteCell.isLock=s[0]==="1",this.lteCell.arfcn=s[1],this.lteCell.pci=s[2]}},getSupportedBand(e){return e.split(",").reduce((t,s,o)=>{let r=parseInt(s).toString(2);for(var n=0;n<r.length;n++)parseInt(r[r.length-n-1])&&t.push(o*8+n+1);return t},[])},getLockedBand(e){return this.getSupportedBand(e).filter(t=>this.list.includes(t))},submit(){let e=[];for(var t=0;t<8;t++){let o="";for(var s=0;s<8;s++)this.checked.includes(t*8+s+1)?o="1"+o:o="0"+o;e.push(parseInt(o,2))}this.write("AT+ZLTEBAND="+e.join(","))},async reboot(){window.open(`http://${this.ip}/goform/goform_set_cmd_process?goformId=REBOOT_DEVICE`)},reboot1869(){window.open(`http://${this.ip}/reqproc/proc_post?isTest=false&goformId=REBOOT_DEVICE`)},async openADB(){window.open(`http://${this.ip}/goform/goform_set_cmd_process?goformId=SET_DEVICE_MODE&debug_enable=1`)},async closeADB(){window.open(`http://${this.ip}/goform/goform_set_cmd_process?goformId=SET_DEVICE_MODE&debug_enable=0`)}},async unmounted(){clearInterval(this.timer);try{this.reader.releaseLock(),this.writer.releaseLock(),await this.port.close(),this.reader={}}catch{}},watch:{dataR(){this.$nextTick(()=>{const e=document.getElementById("scroll_text");e.scrollTop=e.scrollHeight})}}};function T(e){for(var t="",s=0;s<e.length;s++)t+=String.fromCharCode(e[s]);return t}function x(e){for(var t=[],s=0;s<e.length;s++)t.push(e.charCodeAt(s));var o=new Uint8Array(t);return o}const p=e=>(k("data-v-35df9939"),e=e(),A(),e),B={class:"atMaster",style:{padding:"10px"}},E=p(()=>l("label",null,"ip: ",-1)),L={class:"content"},I={style:{padding:"10px 0"}},M={style:{padding:"10px 0"}},D=p(()=>l("label",null,"IMEI: ",-1)),S={style:{padding:"10px 0"}},_=p(()=>l("label",null,"无线MAC: ",-1)),V={style:{padding:"10px 0"}},U=p(()=>l("label",null,"有线MAC: ",-1)),O={style:{display:"flex","flex-wrap":"wrap","align-items":"center",padding:"10px 0"}},Z={for:"option1"},N=["value"],R=p(()=>l("br",null,null,-1)),W=p(()=>l("br",null,null,-1)),G={style:{padding:"10px 0"}},H=p(()=>l("label",null,"频点: ",-1)),q=p(()=>l("label",{style:{"margin-left":"20px"}},"小区: ",-1)),F=p(()=>l("label",{style:{"margin-left":"20px"}},"是否锁定: ",-1)),z=p(()=>l("div",null,[l("label",{style:{opacity:"0.5"}},"显示的仅为之前保存锁定小区的数据，并非是当前实际接入的小区")],-1)),P={class:"right"};function J(e,t,s,o,r,n){return u(),m("div",B,[l("button",{onClick:t[0]||(t[0]=(...i)=>n.click&&n.click(...i))},"选择端口 "+c(r.isOpen?"（已开启）":"（未开启）"),1),l("div",null,[E,d(l("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=i=>r.ip=i)},null,512),[[a,r.ip]]),l("button",{onClick:t[2]||(t[2]=(...i)=>n.openADB&&n.openADB(...i))},"开启adb "),l("button",{onClick:t[3]||(t[3]=(...i)=>n.closeADB&&n.closeADB(...i))},"关闭adb "),l("button",{onClick:t[4]||(t[4]=(...i)=>n.reboot&&n.reboot(...i))},"重启"),l("button",{onClick:t[5]||(t[5]=(...i)=>n.reboot1869&&n.reboot1869(...i))},"重启(1869系列)")]),d(l("div",L,[l("div",I,[l("button",{onClick:t[6]||(t[6]=i=>n.write("AT+ZMODE=1"))},"工厂模式"),l("button",{onClick:t[7]||(t[7]=i=>n.write("AT+ZMODE=0"))},"退出工厂模式")]),l("div",M,[D,d(l("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=i=>r.imei=i)},null,512),[[a,r.imei]]),l("button",{onClick:t[9]||(t[9]=i=>n.write("AT+CGSN"))},"读取"),l("button",{onClick:t[10]||(t[10]=i=>n.write("AT+MODIMEI="+r.imei))},"写入")]),l("div",S,[_,d(l("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=i=>r.mac=i)},null,512),[[a,r.mac]]),l("button",{onClick:t[12]||(t[12]=i=>n.write("AT+MAC?"))},"读取"),l("button",{onClick:t[13]||(t[13]=i=>n.write("AT+MAC="+r.mac))},"写入")]),l("div",V,[U,d(l("input",{type:"text","onUpdate:modelValue":t[14]||(t[14]=i=>r.mac2=i)},null,512),[[a,r.mac2]]),l("button",{onClick:t[15]||(t[15]=i=>n.write("AT+MAC2?"))},"读取"),l("button",{onClick:t[16]||(t[16]=i=>n.write("AT+MAC2="+r.imei))},"写入")]),l("div",O,[(u(!0),m(f,null,v(r.list,(i,g)=>(u(),m("span",{key:g,style:{display:"flex","flex-wrap":"wrap","align-items":"center",padding:"0 5px"}},[l("label",Z,"LTE B"+c(i),1),d(l("input",{type:"checkbox","onUpdate:modelValue":t[17]||(t[17]=h=>r.checked=h),value:i},null,8,N),[[b,r.checked,void 0,{number:!0}]]),R,W]))),128)),l("button",{onClick:t[18]||(t[18]=(...i)=>n.getBand&&n.getBand(...i))},"读取频段"),l("button",{onClick:t[19]||(t[19]=(...i)=>n.submit&&n.submit(...i))},"锁定频段")]),l("div",G,[H,d(l("input",{style:{width:"80px"},type:"text","onUpdate:modelValue":t[20]||(t[20]=i=>r.lteCell.arfcn=i)},null,512),[[a,r.lteCell.arfcn]]),q,d(l("input",{style:{width:"80px"},type:"text","onUpdate:modelValue":t[21]||(t[21]=i=>r.lteCell.pci=i)},null,512),[[a,r.lteCell.pci]]),F,d(l("input",{type:"checkbox","onUpdate:modelValue":t[22]||(t[22]=i=>r.lteCell.isLock=i),value:!0},null,512),[[b,r.lteCell.isLock,void 0,{number:!0}]]),l("button",{onClick:t[23]||(t[23]=i=>n.write("AT+ZLC?"))},"读取"),l("button",{onClick:t[24]||(t[24]=i=>n.write(`AT+ZLC=${r.lteCell.isLock?1:0},${r.lteCell.arfcn},${r.lteCell.pci}`))},"写入"),z]),l("div",null,[d(l("input",{type:"text","onUpdate:modelValue":t[25]||(t[25]=i=>r.dataW=i),placeholder:"发送自定义AT指令"},null,512),[[a,r.dataW]]),l("button",{onClick:t[26]||(t[26]=i=>n.write())},"发送")]),l("div",P,[d(l("textarea",{id:"scroll_text",cols:"30",rows:"10","onUpdate:modelValue":t[27]||(t[27]=i=>r.dataR=i),readonly:""},null,512),[[a,r.dataR]]),l("button",{onClick:t[28]||(t[28]=i=>r.dataR="")},"清理")])],512),[[w,r.isOpen]])])}const Q=C(y,[["render",J],["__scopeId","data-v-35df9939"]]);export{Q as default};
